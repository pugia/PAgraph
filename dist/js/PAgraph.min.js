!function($){function e(e,t){return void 0==t&&(t="value"),Math.max.apply(null,Object.keys(e).map(function(a){var n=e[a][t];if(n instanceof Object){var r=0;$.each(n,function(e,t){r+=t}),n=r}return n}))}function t(e,t){return void 0==t&&(t="value"),Math.min.apply(null,Object.keys(e).map(function(a){var n=e[a][t];if(n instanceof Object){var r=0;$.each(n,function(e,t){r+=t}),n=r}return n}))}function a(e,t){void 0==t&&(t="value");var a=0;for(var n in e)a+=e[n][t];return a}function n(){return"#"+(16777215*Math.random()<<0).toString(16)}$.fn.PAgraph=function(a){function n(){return"#"+(16777215*Math.random()<<0).toString(16)}function r(a,n){var n=n||5,r=1,l=e(a),i=d.config.stacked?0:t(a);if(1.5>=l&&(r=10),i*=r,l*=r,i==l)return Array.apply(null,Array(n+1)).map(function(e,t){return i+10*(t-1)});var s=i?Math.ceil(.05*(l-i)):0,o=Math.ceil(.05*(l-i));i-=s,l+=o;for(var p=Math.round((l-i)/n),c=10*(p.toString().length-1)||1,g=Math.round(2*p/c)/2*c,u=Math.floor(i/g)*g/r,h=[],v=0;n>=v;v++)h.push(Number(u).format({decimals:String(r).length-1})),u+=g/r;return h}function l(e){var t=[];for(var a in e)for(var n in e[a])t.push(e[a][n]);return t}function s(e){var t=$.extend(!0,null,e),a=[];return $.each(t,function(e,t){$.each(t,function(t,n){0==e?a[t]=n:d.config.stacked?a[t].value+=n.value:a.push(n)})}),a}function o(){d.debug&&console.debug(arguments)}var d=$.extend(!0,{mode:"history",filter:{mode:"daily",labels:["daily","weekly","monthly"]},config:{graph:[],grid:{x:{show:!0,color:"#E2E6E9",label:"#C1C1C1",format:function(e){return e}},y:{show:!0,color:"#C6CED3",label:"#C1C1C1",format:null}},spacing:10,stacked:!1,rectRadius:5},lineInterpolation:"cardinal",interpolateOnZero:!0,preFetch:null},a),p=this;p.addClass("PAgraphContainer");var c={legend:null,tooltip:null,data:[],filters:null,svg:{element:null,grid:{group:null,x:{group:null,elements:[]},y:{group:null,elements:[]}},label:{x:{group:null,elements:[]},y:{group:null,spacing:[],elements:[]}},graph:{group:null,elements:[]}}},g={group:null,elements:{line:null,area:null,points:{coords:[],elements:[]}}},u={labels:{x:{height:30,marginTop:15},y:{width:60,marginLeft:10}},graphAnimationTime:600,animateGridTime:500,animateEasing:"cubic-in-out",graphLineInterpolation:d.lineInterpolation};c.legend=d3.selectAll(p.get()).append("div").classed("PAlegend",!0),c.tooltip=d3.selectAll(p.get()).append("div").classed("PAtooltip",!0),c.tooltip.append("span").text("3123"),c.tooltip.append("label").text("metric"),c.svg.element=d3.selectAll(p.get()).append("svg").classed("PAGraph",!0).classed("PAMode"+d.mode.capitalizeFirstLetter(),!0).attr("width",p.width()).attr("height",p.height()),c.svg.grid.group=c.svg.element.append("g").classed("PAGgrid",!0),c.svg.label.x.group=c.svg.element.append("g").classed("PAGlabelX",!0),c.svg.label.y.group=c.svg.element.append("g").classed("PAGlabelY",!0),c.svg.graph.group=c.svg.element.append("g").classed("PAGgraphs",!0);var h={history:{filter:"daily",computedData:[null,null],init:function(){o("MODE: history");var e=this;e.initLegend(),e.initCircles(),e.initFilters(),e.grid()},grid:function(){var e=this;e.initGridX(),e.initGridY()},initGridX:function(){var e=this,t=p.width(),a=p.height(),n=0,r=8;0!=d.config.grid.x.label&&(a-=u.labels.x.height),0!=d.config.grid.y.label&&(n=u.labels.y.width,t-=n);var l=Math.floor(t/(r-1));c.svg.grid.x.group=c.svg.grid.group.append("g").classed("PAGgridX",!0);for(var i=0;r>i;i++){var s=i*l+n,o=c.svg.grid.x.group.append("line").attr("x1",s).attr("y1",0).attr("x2",s).attr("y2",a).attr("stroke",d.config.grid.x.color);c.svg.grid.x.elements.push(o)}},initGridY:function(){var e=this,t=p.width(),a=p.height(),n=0;0!=d.config.grid.x.label&&(a-=u.labels.x.height),0!=d.config.grid.y.label&&(n=u.labels.y.width,t-=n);var r=6,l=Math.floor(a/r);c.svg.grid.y.group=c.svg.grid.group.append("g").classed("PAGgridY",!0);for(var i=0;r>i;i++){var s=c.svg.grid.y.group.append("line").attr("x1",n).attr("y1",a-i*l).attr("x2",p.width()).attr("y2",a-i*l).attr("stroke",d.config.grid.y.color);c.svg.grid.y.elements.push(s)}},initGraph:function(e,t,a,n){var r=this,l=$.Deferred();if(e&&c.svg.graph.elements[e])return l.resolve(e),l.promise();var i=p.width(),s=p.height(),o=0,h=$.extend(!0,{},g);h.group=c.svg.graph.group.insert("g",":first-child").classed("PAGgraph",!0),c.svg.graph.elements.push(h);var v=c.svg.graph.elements.length-1;c.svg.graph.elements[v].group.attr("data-index",v);var t=t||"#"+((1<<24)*Math.random()|0).toString(16),a=a||"Graph "+v,n=n||null;d.config.graph.push({color:t,legend:a,format:n});var f=c.svg.grid.x.elements.length||8;c.svg.element.attr("data-points",f),0!=d.config.grid.x.label&&(s-=u.labels.x.height),0!=d.config.grid.y.label&&(o=u.labels.y.width);for(var m=Math.floor(i/(f-1)),y=[],x=0;f>x;x++){var b=x*m+o;y.push({x:b,y:s})}var A=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate(u.graphLineInterpolation),C=A(y),P=c.svg.graph.elements[v].group.append("path").classed("PAGgraphLine",!0).attr("d",C).attr("stroke",d.config.graph[v].color).attr("stroke-width",1).attr("fill","none");c.svg.graph.elements[v].elements.line=P;var w=c.svg.graph.elements[v].group.append("path").classed("PAGgraphArea",!0).attr("d",C).attr("stroke-width",0).attr("fill",d.config.graph[v].color);c.svg.graph.elements[v].elements.area=w;var T=c.legend.append("p").attr("data-index",v);return T.append("span").style("background",d.config.graph[v].color),T.append("label").text(d.config.graph[v].legend),setTimeout(function(){l.resolve(v)},25*f),l.promise()},initLegend:function(){var e=this;p.find("div.PAlegend").addClass("PAhide").on("click","p[data-index]",function(){var t=parseInt($(this).attr("data-index"));e.moveOnFront(t)})},initFilters:function(){var e=this;c.filters=d3.selectAll(p.get()).insert("div",":first-child").classed("PAfilters",!0),c.filters.append("p").attr("data-mode","daily").text(d.filter.labels[0]),c.filters.append("p").attr("data-mode","weekly").text(d.filter.labels[1]),c.filters.append("p").attr("data-mode","monthly").text(d.filter.labels[2]),p.find("div.PAfilters").addClass("PAhide").on("click","p[data-mode]",function(){d.filter.mode=$(this).attr("data-mode"),e.applyFilter()})},setData:function(e,t){var a=this,n=$.Deferred(),t=t||0;if(c.data[0]&&c.data.length&&0==t&&c.data[0].length!=e.length&&(c.data=[],a.computedData=[]),e&&0!=e.length||n.reject("no"),0!=t&&c.data[0]&&c.data[0].length!=e.length)console.log("Compare metric has a different scale"),n.reject("no");else{c.data[t]=e,0==t&&(c.filters.classed("PAhide",!0),c.data[0].length>=28?(c.data[0].length>40&&"daily"==d.filter.mode&&(d.filter.mode="weekly"),c.filters.select('p[data-mode="daily"]').classed("PAhide",c.data[0].length>60),c.filters.select('p[data-mode="monthly"]').classed("PAhide",c.data[0].length<120),c.data[0].length<120&&"monthly"==d.filter.mode&&(d.filter.mode="daily"),c.filters.selectAll("p").classed("selected",!1),c.filters.select('p[data-mode="'+d.filter.mode+'"]').classed("selected",!0),setTimeout(function(){c.filters.classed("PAhide",!1)},u.animateGridTime)):(d.filter.mode="daily",c.filters.selectAll("p").classed("selected",!1),c.filters.select('p[data-mode="'+d.filter.mode+'"]').classed("selected",!0))),a.computedData[t]=a.applyFilterToData(e,d.filter.mode);var i=l(a.computedData);c.svg.grid.y.spacing=r(i),setTimeout(function(){n.resolve("ok")},10)}return n.promise()},draw:function(){var e=this;if(promises=[],promises.push(e.animateGridX(e.computedData[0])),promises.push(e.animateLabelY(e.computedData[0])),parseInt(c.svg.element.attr("data-points"))!=e.computedData[0].length)for(var t in c.svg.graph.elements)promises.push(e.flattenGraph(t));$.when.apply($,promises).done(function(){p.find("div.PAlegend").toggleClass("PAhide",e.computedData.length<2),c.svg.element.attr("data-points",e.computedData[0].length);for(var t in c.svg.graph.elements)e.computedData[t]?e.animateGraph(e.computedData[t],t):e.removeGraph(t)})},removeGraph:function(e){var t=this,a=$.Deferred(),e=e||c.data.length-1;return $.when(t.flattenGraph(e)).done(function(){0==e?a.reject():(c.svg.graph.elements[e].group.remove(),c.svg.graph.elements.splice(e,1),p.find("div.PAlegend > p[data-index="+e+"]").remove(),delete c.data[e],t.computedData[e]=null,a.resolve())}).fail(function(){a.resolve()}),a.promise()},applyFilter:function(){var e=this;c.filters.selectAll("p").classed("selected",!1),c.filters.select('p[data-mode="'+d.filter.mode+'"]').classed("selected",!0),e.computedData[0]=e.applyFilterToData(c.data[0],d.filter.mode),e.computedData[1]=e.applyFilterToData(c.data[1],d.filter.mode);var t=l(e.computedData);c.svg.grid.y.spacing=r(t),e.draw()},animateGraph:function(t,a){var n=this;if(!c.svg.graph.elements[a])return void console.log("structure not exist");var r=p.width(),l=p.height(),i=0;0!=d.config.grid.x.label&&(l-=u.labels.x.height),0!=d.config.grid.y.label&&(i=u.labels.y.width,r-=i);var s=Math.floor(r/(t.length-1)),o=Math.floor(l/6)/(c.svg.grid.y.spacing[1]-c.svg.grid.y.spacing[0]);c.svg.graph.elements[a].group.selectAll("circle").classed("PAhide","true"),setTimeout(function(){c.svg.graph.elements[a].group.selectAll("circle.PAhide").remove()},300);var g=[],h=g.length,v=[],f=[];for(var m in t){var y=m*s+i,x=parseInt(l-(t[m].value-c.svg.grid.y.spacing[0])*o);v.push({x:y,y:x}),d.interpolateOnZero||(f.push({x:y,y:x}),0==t[m].value&&(g.push(f),f=[],f.push({x:y,y:x})))}g.length||g.push(v),c.svg.graph.elements[a].elements.points.coords=v;var b=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate(u.graphLineInterpolation);if(d.interpolateOnZero)var A=b(v);else{var A="";for(var C in g)A+=b(g[C]);var P=/M(.\d*),(.\d*)/,w=P.exec(A)[0];A=w+A.replace(/M(.\d*),(.\d*)/gim,"")}pathCoordArea=A,pathCoordArea+="L"+e(v,"x")+","+l,pathCoordArea+="L"+i+","+l,pathCoordArea+="L"+i+","+v[0].y,c.svg.graph.elements[a].elements.area.transition().duration(u.graphAnimationTime).attr("d",pathCoordArea).ease(u.animateEasing),c.svg.graph.elements[a].elements.line.transition().duration(u.graphAnimationTime).attr("d",A).ease(u.animateEasing).each("end",function(){n.animateCircles(t,a)})},flattenGraph:function(t){var a=this;o("flattenGraph",t);var n=$.Deferred(),r=p.width(),l=p.height(),i=0;if(!c.svg.graph.elements[t])return n.reject(),n.promise();var s=parseInt(c.svg.element.attr("data-points"));0!=d.config.grid.x.label&&(l-=u.labels.x.height),0!=d.config.grid.y.label&&(i=u.labels.y.width,r-=i);for(var g=Math.floor(r/(s-1)),h=[],v=0;s>v;v++){var f=v*g+i;h.push({x:f,y:l})}var m=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate(u.graphLineInterpolation),y=m(h);if(pathCoordArea=y,pathCoordArea+="L"+e(h,"x")+","+(l+1),pathCoordArea+="L"+i+","+(l+1),pathCoordArea+="L"+i+","+h[0].y,a.computedData[t]&&a.computedData[t].length){for(var x=Math.floor(r/(a.computedData[t].length-1)),h=[],v=0;v<a.computedData[t].length;v++){var f=v*x+i;h.push({x:f,y:l})}var m=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate(u.graphLineInterpolation),b=m(h);pathCoordAreaNext=b,pathCoordAreaNext+="L"+e(h,"x")+","+(l+1),pathCoordAreaNext+="L"+i+","+(l+1),pathCoordAreaNext+="L"+i+","+h[0].y}return c.svg.graph.elements[t].group.selectAll("circle").transition().duration(u.graphAnimationTime).attr("cy",l).style("opacity",0).remove(),c.svg.graph.elements[t].elements.area.transition().duration(u.graphAnimationTime).attr("d",pathCoordArea).ease(u.animateEasing).each("end",function(){d3.select(this).attr("d",pathCoordAreaNext)}),c.svg.graph.elements[t].elements.line.transition().duration(u.graphAnimationTime).attr("d",y).ease(u.animateEasing).each("end",function(){d3.select(this).attr("d",b),n.resolve()}),n.promise()},animateGridX:function(e){var t=this;o("animateGridX");var a=$.Deferred();t.animateLabelX(e);var n=p.width(),r=p.height(),l=0,i=e.length;0!=d.config.grid.x.label&&(r-=u.labels.x.height),0!=d.config.grid.y.label&&(l=u.labels.y.width,n-=l);var s=Math.floor(n/(i-1));if(i>c.svg.grid.x.elements.length)for(var g=i-c.svg.grid.x.elements.length,h=0;g>h;h++){var v=c.svg.grid.x.group.append("line").attr("x1",n+l+50).attr("y1",0).attr("x2",n+l+50).attr("y2",r).attr("stroke",d.config.grid.x.color).attr("data-count",h);c.svg.grid.x.elements.push(v)}for(var f in c.svg.grid.x.elements){var m=f*s+l;c.svg.grid.x.elements[f].transition().duration(u.animateGridTime).attr("x1",m).attr("x2",m).ease(u.animateEasing)}return setTimeout(function(){if(i<c.svg.grid.x.elements.length){for(var e=c.svg.grid.x.elements.length-i,t=0;e>t;t++){var n=t+i;c.svg.grid.x.elements[n].remove()}c.svg.grid.x.elements.splice(i,e)}a.resolve()},u.animateGridTime),a.promise()},animateLabelX:function(e){var t=this,a=$.Deferred(),n=p.width(),r=p.height(),l=0,i=e.length;d.config.grid.x.label&&(r-=u.labels.x.height),d.config.grid.y.label&&(l=u.labels.y.width,n-=l);var s=Math.floor(n/(e.length-1));if(c.svg.label.x.group.classed("PAhide",!0).selectAll("text").classed("show",!1),setTimeout(function(){for(var t in e){var n=t*s+l;if(c.svg.label.x.elements[t])c.svg.label.x.elements[t].attr("x",n).text(d.config.grid.x.format(e[t].label));else{var i=c.svg.label.x.group.append("text").attr("x",n).attr("y",r+u.labels.x.marginTop).attr("text-anchor","middle").attr("fill",d.config.grid.x.label).text(d.config.grid.x.format(e[t].label));c.svg.label.x.elements.push(i)}}a.resolve()},u.animateGridTime),i<c.svg.label.x.elements.length){for(var o=c.svg.grid.x.elements.length-i,g=0;o>g;g++){var h=g+i;c.svg.label.x.elements[h]&&c.svg.label.x.elements[h].remove()}c.svg.label.x.elements.splice(i,o)}return setTimeout(function(){t.hideThickLabels()},2*u.animateGridTime),a},hideThickLabels:function(){function e(e){var t=$("<span>").hide().appendTo(document.body);t.text(e.text()).css("font-family",e.css("font-family")).css("font-weight",e.css("font-weight")).css("font-size",e.css("font-size")).css("text-transform",e.css("text-transform"));var a=t.width();return t.remove(),a}for(var t=this,a=p.find("g.PAGlabelX"),n=1,r=1,l=a.find("text:eq("+r+")"),i={width:e(l),x:l.position().left},s=2,o=a.find("text:eq("+s+")").position().left;i.x+i.width+10>o;)n++,s++,o=a.find("text:eq("+s+")").position().left;c.svg.label.x.group.selectAll("text:nth-child("+n+"n+2)").classed("show",!0)},animateLabelY:function(e){var t=this;o("animateLabelY");var a=p.width(),n=p.height(),r=0,l=e.length;d.config.grid.x.label&&(n-=u.labels.x.height),d.config.grid.y.label&&(r=u.labels.y.width,a-=r);var l=6,i=Math.floor(n/l);c.svg.label.y.group.classed("PAhide",!0),setTimeout(function(){for(var e=0;l>e;e++)if(c.svg.label.y.elements[e])c.svg.label.y.elements[e].text(c.svg.grid.y.spacing[e]);else{var t=c.svg.label.y.group.append("text").attr("x",50).attr("y",n-e*i).attr("text-anchor","end").attr("fill",d.config.grid.y.label).text(Number(c.svg.grid.y.spacing[e]).format(d.config.grid.y.format));c.svg.label.y.elements.push(t)}},u.animateGridTime),setTimeout(function(){c.svg.label.y.group.classed("PAhide",!1)},2*u.animateGridTime)},animateCircles:function(e,t){var a=this;for(var n in c.svg.graph.elements[t].elements.points.coords){var r=c.svg.graph.elements[t].elements.points.coords[n],l=c.svg.graph.elements[t].group.append("circle").attr("cx",r.x).attr("cy",r.y).attr("r",0).attr("stroke-width",2).attr("stroke",d.config.graph[t].color).attr("fill","#fff").attr("data-value",e[n].value).attr("data-xStep",n).transition().delay(20*n).attr("r",4).ease(u.animateEasing);c.svg.graph.elements[t].elements.points.elements.push(l)}},setLegendLabel:function(e,t){var a=this;d.config.graph[t].legend=e,c.legend.select('p[data-index="'+t+'"] > label').text(e)},initCircles:function(){var e=this,t=null;p.on("mouseover","circle",function(){c.tooltip.style("display","block"),clearTimeout(t);var e=$(this).parent("g").attr("data-index"),a=$(this).attr("data-value");c.tooltip.style("color",d.config.graph[e].color).select("span").html(Number(a).format(d.config.graph[e].format)),c.tooltip.select("label").text(d.config.graph[e].legend);var n=c.tooltip.node().getBoundingClientRect(),r=$(c.tooltip[0][0]),l=r.width(),i=r.height(),s=$(this).attr("cx"),o=$(this).attr("cy"),p=o-i-20,g=s-parseInt(l/2)-10;r.css("top",p).css("left",g).addClass("show")}).on("mouseout","circle",function(){c.tooltip.classed("show",!1),t=setTimeout(function(){c.tooltip.style("display","none")},300)})},moveOnFront:function(e){var t=this,a=p.find("g.PAGgraphs");a.find("g.PAGgraph[data-index="+e+"]").appendTo(a)},applyFilterToData:function(e,t){function a(e){return e}function n(e){var t=[],a={label:"",value:0},n={},r=0;for(var l in e)l%7==0&&(n=$.extend(!0,{},a),n.label=e[l].label,t.push(n),r=t.length-1),t[r].value+=e[l].value;return t}function r(e){var t=[],a={label:"",value:0},n={},r=0;for(var l in e)l%30==0&&(n=$.extend(!0,{},a),n.label=e[l].label,t.push(n),r=t.length-1),t[r].value+=e[l].value;return t}var l=this,t=t||"daily",i=e;if(null==e)return null;switch(t){case"weekly":i=n(e);break;case"monthly":i=r(e);break;case"daily":i=a(e)}return i}},bars:{init:function(){o("MODE: weekday");var e=this;e.grid()},grid:function(){var e=this;e.initGridY(),e.initLegend(),e.initRects()},initGridY:function(){var e=this,t=p.width(),a=p.height(),n=0;0!=d.config.grid.x.label&&(a-=u.labels.x.height),0!=d.config.grid.y.label&&(n=u.labels.y.width,t-=n);var r=6,l=Math.floor(a/r);c.svg.grid.y.group=c.svg.grid.group.append("g").classed("PAGgridY",!0);for(var i=0;r>i;i++){var s=c.svg.grid.y.group.append("line").attr("x1",n).attr("y1",a-i*l).attr("x2",p.width()).attr("y2",a-i*l).attr("stroke",d.config.grid.y.color);c.svg.grid.y.elements.push(s)}},initGraph:function(e,t,a,n){var r=this,l=$.Deferred();if(void 0!=typeof e&&c.svg.graph.elements[e])return l.resolve(e),l.promise();var i=c.data[0]?c.data[0].length:5,s=p.width(),h=p.height(),v=0,f=$.extend(!0,{},g);f.group=c.svg.graph.group.insert("g",":first-child").classed("PAGgraph",!0),f.elements.area=[],c.svg.graph.elements.push(f);var m=c.svg.graph.elements.length-1;c.svg.graph.elements[m].group.attr("data-index",m);var t=t||"#"+((1<<24)*Math.random()|0).toString(16),a=a||"Graph "+m,n=n||null;d.config.graph.push({color:t,legend:a,format:n}),o("initGraph",e),0!=d.config.grid.x.label&&(h-=u.labels.x.height),0!=d.config.grid.y.label&&(v=u.labels.y.width,s-=v);for(var y=Math.floor(s/i),x=d.config.stacked?0:d.config.spacing/2,b=y-d.config.spacing-(c.svg.graph.elements.length-1)*x,A=0;i>A;A++){var C=A*y+v+y/2-b/2+m*x,P=h-1,w=c.svg.graph.elements[m].group.append("rect").attr("x",C).attr("y",P).attr("width",b).attr("height",1).attr("rx",d.config.rectRadius).attr("ry",d.config.rectRadius).attr("fill",d.config.graph[m].color).style("opacity",0);c.svg.graph.elements[m].elements.area.push(w)}var T=c.legend.append("p").attr("data-index",m);return T.append("span").style("background",d.config.graph[m].color),T.append("label").text(d.config.graph[m].legend),0==m&&r.initLabelX(),setTimeout(function(){l.resolve(m)},25*i),l.promise()},initLabelX:function(){var e=this,t=5;o("initLabelX");var a=p.width(),n=p.height(),r=0;0!=d.config.grid.x.label&&(n-=u.labels.x.height),0!=d.config.grid.y.label&&(r=u.labels.y.width,a-=r);for(var l=Math.floor(a/t),i=0;t>i;i++){var s=i*l+r+l/2,g=c.svg.label.x.group.append("text").attr("x",s).attr("y",n+u.labels.x.marginTop).attr("text-anchor","middle").attr("fill",d.config.grid.x.label);c.svg.label.x.elements.push(g)}},animateLabelY:function(){var e=this,t=e.computedData,a=p.width(),n=p.height(),r=0;o("animateLabelY");var l=t.length;d.config.grid.x.label&&(n-=u.labels.x.height),d.config.grid.y.label&&(r=u.labels.y.width,a-=r);var l=6,i=Math.floor(n/l);c.svg.label.y.group.classed("PAhide",!0),setTimeout(function(){for(var e=0;l>e;e++)if(c.svg.label.y.elements[e])c.svg.label.y.elements[e].text(Number(c.svg.grid.y.spacing[e]).format(d.config.grid.y.format));else{var t=c.svg.label.y.group.append("text").attr("x",50).attr("y",n-e*i).attr("text-anchor","end").attr("fill",d.config.grid.y.label).text(Number(c.svg.grid.y.spacing[e]).format(d.config.grid.y.format));c.svg.label.y.elements.push(t)}},u.animateGridTime),setTimeout(function(){c.svg.label.y.group.classed("PAhide",!1)},2*u.animateGridTime)},animateGridX:function(){var e=this,t=$.Deferred(),a=p.width(),n=p.height(),r=0;if(o("animateGridX"),c.svg.label.x.group.classed("PAhide",!0),c.svg.graph.elements[0].elements.area.length!=c.data[0].length){for(var l=c.data[0].length;l<c.svg.graph.elements[0].elements.area.length;l++)c.svg.label.x.elements[l].transition().duration(u.graphAnimationTime).style("opacity",0).ease(u.animateEasing).each("end",function(){this.remove()}),setTimeout(function(){c.svg.label.x.elements=c.svg.label.x.elements.slice(0,c.data[0].length)},u.graphAnimationTime);0!=d.config.grid.x.label&&(n-=u.labels.x.height),0!=d.config.grid.y.label&&(r=u.labels.y.width,a-=r);var i=Math.floor(a/c.data[0].length),s=d.config.stacked?0:d.config.spacing/2,g=i-d.config.spacing;for(var h in c.data)for(var l in c.data[h]){var v=l*i+r+i/2-g/2+h*s;if(c.svg.graph.elements[h].elements.area[l])c.svg.graph.elements[h].elements.area[l].transition().duration(u.graphAnimationTime).attr("width",g).attr("x",v);else{var f=c.svg.graph.elements[h].group.append("rect").attr("x",v).attr("y",n-1).attr("width",g).attr("height",1).attr("rx",d.config.rectRadius).attr("ry",d.config.rectRadius).attr("fill",d.config.graph[h].color).attr("opacity",0);f.transition().delay(u.graphAnimationTime/4).duration(u.graphAnimationTime),c.svg.graph.elements[h].elements.area.push(f)}if(0==h){var m=l*i+r+i/2;if(c.svg.label.x.elements[l])c.svg.label.x.elements[l].transition().duration(u.graphAnimationTime/4),c.svg.label.x.elements[l].transition().delay(u.graphAnimationTime/4).duration(u.graphAnimationTime).attr("x",m).text(d.config.grid.x.format(c.data[0][l].label));else{var y=c.svg.label.x.group.append("text").attr("x",m).attr("y",n+u.labels.x.marginTop).attr("text-anchor","middle").attr("fill",d.config.grid.x.label).text(d.config.grid.x.format(c.data[0][l].label));y.transition().delay(u.graphAnimationTime/4).duration(u.graphAnimationTime),c.svg.label.x.elements.push(y)}}}}else for(var l in c.data[0])c.svg.label.x.elements[l].text(c.data[0][l].label);return setTimeout(function(){e.hideThickLabels(),t.resolve()},u.animateGridTime+100),t.promise()},hideThickLabels:function(){function e(e){var t=$("<span>").hide().appendTo(document.body);t.text(e.text()).css("font-family",e.css("font-family")).css("font-weight",e.css("font-weight")).css("font-size",e.css("font-size")).css("text-transform",e.css("text-transform"));var a=t.width();return t.remove(),a}o("hideThickLabels");for(var t=this,a=p.find("g.PAGlabelX"),n=1,r=1,l=a.find("text:eq("+r+")"),i={width:e(l),x:l.position().left},s=2,d=a.find("text:eq("+s+")").position().left;i.x+i.width+10>d;)n++,s++,d=a.find("text:eq("+s+")").position().left;n>1?c.svg.label.x.group.classed("PAhide",!0).selectAll("text:nth-child("+n+"n+2)").classed("show",!0):c.svg.label.x.group.classed("PAhide",!1).selectAll("text").classed("show",!1)},setData:function(e,t){var a=this,n=$.Deferred(),t=t||0,g=p.width(),h=p.height(),v=0;if(0!=d.config.grid.x.label&&(h-=u.labels.x.height),0!=d.config.grid.y.label&&(v=u.labels.y.width,g-=v),o("setData",t),c.data.length&&0==t&&c.data[0].length!=e.length&&(c.data=[]),c.svg.graph.elements[t].elements.area.length>e.length){for(i=e.length;i<c.svg.graph.elements[t].elements.area.length;i++)c.svg.graph.elements[t].elements.area[i].transition().duration(u.graphAnimationTime).attr("y",h).attr("height",0).style("opacity",0).ease(u.animateEasing).each("end",function(){this.remove()});setTimeout(function(){c.svg.graph.elements[t].elements.area=c.svg.graph.elements[t].elements.area.slice(0,e.length)},u.graphAnimationTime)}return e&&0!=e.length||n.reject("no"),0!=t&&c.data[0]&&c.data[0].length!=e.length?(console.log("Compare metric has a different scale"),n.reject("no")):(c.data[t]=e,a.computedData=l(c.data),c.svg.grid.y.spacing=r(s(c.data)),setTimeout(function(){n.resolve("ok")},10)),n.promise()},draw:function(){var e=this;o("draw"),promises=[],promises.push(e.animateLabelY()),promises.push(e.animateGridX()),$.when.apply($,promises).done(function(){p.find("div.PAlegend").toggleClass("PAhide",c.data.length<2);for(var t in c.svg.graph.elements)c.data[t]?e.animateGraph(c.data[t],t):e.removeGraph(t)})},animateGraph:function(e,t){var a=this,t=t||0;o("animateGraph",t);var n=p.width(),r=p.height(),l=0;0!=d.config.grid.x.label&&(r-=u.labels.x.height),0!=d.config.grid.y.label&&(l=u.labels.y.width,n-=l);var i=Math.floor(n/e.length),s=Math.floor(r/6)/(c.svg.grid.y.spacing[1]-c.svg.grid.y.spacing[0]),g=d.config.stacked?0:d.config.spacing/2,h=i-d.config.spacing-(c.svg.graph.elements.length-1)*g;for(var v in c.svg.graph.elements[t].elements.area)if("undefined"!=typeof e[v]){var f=e[v].value?parseInt(e[v].value*s-c.svg.grid.y.spacing[0]*s):1,m=r-f;if(d.config.stacked&&t>0)for(var l=1*t;l>0;){l-=1;var y=c.data[l][v].value?parseInt(c.data[l][v].value*s-c.svg.grid.y.spacing[0]*s):1;m-=y}c.svg.graph.elements[t].elements.area[v].transition().duration(u.graphAnimationTime).attr("y",m).attr("width",h).attr("height",f).attr("data-value",e[v].value).style("opacity",1).ease(u.animateEasing)}},flattenGraph:function(e){var t=this,a=$.Deferred();if(o("flattenGraph",e),null==c.data[e])return a.reject(),a.promise();var n=p.height();0!=d.config.grid.x.label&&(n-=u.labels.x.height),c.svg.graph.elements[0].group.classed("percentage",!1);for(var r in c.svg.graph.elements[e].elements.area)c.svg.graph.elements[e].elements.area[r].transition().duration(u.graphAnimationTime).attr("y",n-1).attr("height",1).ease(u.animateEasing);return setTimeout(function(){a.resolve()},u.graphAnimationTime+10),a.promise()},removeGraph:function(e){var t=this,a=$.Deferred(),e=e||c.svg.graph.elements.length-1;return $.when(t.flattenGraph(e)).done(function(){0==e?a.reject():(delete c.data[e],c.svg.graph.elements[e].group.remove(),c.svg.graph.elements.pop(),p.find("div.PAlegend > p[data-index="+e+"]").remove(),t.computedData=l(c.data),c.svg.grid.y.spacing=r(s(c.data)),a.resolve())}),a.promise()},initLegend:function(){var e=this;p.find("div.PAlegend").on("click","p[data-index]",function(){var t=parseInt($(this).attr("data-index"));e.moveOnFront(t)})},setLegendLabel:function(e,t){var a=this;d.config.graph[t].legend=e,c.legend.select('p[data-index="'+t+'"] > label').text(e)},initRects:function(){var e=this,t=null;p.on("mouseover","g.PAGgraph > rect",function(){clearTimeout(t),c.tooltip.style("display","block");var e=$(this).parent("g").attr("data-index");c.tooltip.style("color",d.config.graph[e].color).select("span").text(Number($(this).attr("data-value")).format(d.config.grid.y.format)),c.tooltip.select("label").text(d.config.graph[e].legend);var a=c.tooltip.node().getBoundingClientRect(),n=$(c.tooltip[0][0]),r=n.width(),l=n.height(),i=$(this).attr("x"),s=$(this).attr("y"),o=$(this).attr("width"),p=s-l-8,g=i-parseInt(r/2-o/2)-10;n.css("top",p).css("left",g).addClass("show")}).on("mouseout","g.PAGgraph > rect",function(){c.tooltip.classed("show",!1),t=setTimeout(function(){c.tooltip.style("display","none")},300)})},initCompareValues:function(){var e=this;if(null!=c.data[1]){var t=p.height();0!=d.config.grid.x.label&&(t-=u.labels.x.height);for(var a in c.data[0]){var n=c.data[0][a].value-c.data[1][a].value,r=Math.round(n/c.data[1][a].value*100);if(r=r>0?"+"+r+"%":0==r?"":r+"%",c.svg.graph.elements[0].elements.points.elements[a])c.svg.graph.elements[0].elements.points.elements[a].text(r);else{var l=c.svg.graph.elements[0].elements.area[a],i=parseInt(l.attr("x"))+parseInt(l.attr("width")/2),s=c.svg.graph.elements[0].group.append("text").attr("x",i).attr("y",t-u.labels.x.marginTop/2).attr("text-anchor","middle").attr("fill","#fff").text(r);c.svg.graph.elements[0].elements.points.elements.push(s)}}setTimeout(function(){c.svg.graph.elements[0].group.classed("percentage",!0)},u.graphAnimationTime)}},moveOnFront:function(e){var t=this,a=p.find("g.PAGgraphs");a.find("g.PAGgraph[data-index="+e+"]").appendTo(a)}},vertical_bar:$.extend(!0,null,this.bars)};return h[d.mode].init(),p.initGraph=function(e,t,a,n){return h[d.mode].initGraph(e,t,a,n)},p.setData=function(e,t){if("function"==typeof d.preFetch)var e=d.preFetch(e);return h[d.mode].setData(e,t)},p.getData=function(e){return c.data[e]},p.getFormat=function(){return d.config.grid.y.format},p.removeGraph=function(e){return h[d.mode].removeGraph(e)},p.draw=function(){h[d.mode].draw()},p.setLegendLabel=function(e,t){h[d.mode].setLegendLabel(e,t)},d.debug&&(p.structure=c,p.MODE=h),p},$.fn.PAdonutchart=function(e){function t(e){for(var t=["#6D96A1","#596970","#A9AEC5","#553E5A","#859680","#8C4354","#87B8C4","#808F96"],a=[],n=0;n<e.length;n++)a.push(e[n].label);s.svg.color=d3.scale.ordinal().domain(a).range(t)}function a(e){return e.map(function(e){return{label:e.label,value:e.value}})}function n(){var e=$(s.svg.element)[0][0],t=s.legend.selectAll("p").data(s.svg.color.domain()).enter().append("p").attr("data-index",function(e,t){return t});t.append("span").attr("opacity",0).transition().duration(500).delay(1e3).attr("opacity",1).style("background",s.svg.color),t.append("label").attr("opacity",0).transition().duration(500).delay(1e3).attr("opacity",1).text(function(e){return e}),t.classed("small",t[0].length>3)}function r(e){var t=null,a=s.svg.element.select(".slices").selectAll("path").data(s.svg.pie(e),s.svg.key);a.enter().insert("path").style("fill",function(e){return s.svg.color(e.data.label)}).attr("class","slice"),a.transition().duration(1e3).attrTween("d",function(e){var t=d3.interpolate(e.startAngle+.1,e.endAngle);return function(a){return e.endAngle=t(a),s.svg.arc(e)}}),a.on("mouseover",function(){var e=arguments[0];clearTimeout(t),s.tooltip.style("display","block"),s.tooltip.select("span").text(e.data.label),i.after?s.tooltip.select("label").text(e.data.value+" "+i.after):s.tooltip.select("label").text(e.data.value);var a=$(s.tooltip[0][0]);a.css("left",d3.event.layerX+10+"px").css("top",d3.event.layerY+10+"px").css("width","50px").addClass("show")}),a.on("mouseout",function(){s.tooltip.classed("show",!1),t=setTimeout(function(){s.tooltip.style("display","none")},300)}),a.exit().remove()}var l=this;l.addClass("PAgraphContainer PAdonutchart");var i=$.extend(!0,{after:null},e.settings),s={legend:null,tooltip:null,data:[],filters:null,svg:{radius:null,element:null,pie:null,arc:null,outer_arc:null,key:null,color:null,g:null}};return s.legend=d3.selectAll(l.get()).append("div").classed("PAlegend",!0),s.tooltip=d3.selectAll(l.get()).append("div").classed("PAtooltip",!0),s.tooltip.append("span").text("3123"),s.tooltip.append("label").text("metric"),s.svg.element=d3.selectAll(l.get()).append("svg").classed("PAGraph",!0).attr("width",l.width()).attr("height",l.height()),s.svg.radius=Math.min(l.width(),l.height()-40)/2,s.svg.g=s.svg.element.append("g").attr("class","slices"),s.svg.pie=d3.layout.pie().sort(null).value(function(e){return e.value}),s.svg.arc=d3.svg.arc().outerRadius(.8*s.svg.radius).innerRadius(.4*s.svg.radius),s.svg.outer_arc=d3.svg.arc().outerRadius(.9*s.svg.radius).innerRadius(.9*s.svg.radius),s.svg.g.attr("transform","translate("+l.width()/4+","+(l.height()-50)/2+")"),s.svg.key=function(e){return e.data.label},t(e.data),r(a(e.data)),n(e.data),l.animate=function(e){s.svg.element.select("slices").remove(),r(e),n()},l},$.fn.PAbubblechart=function(e){var t={margin:{top:e.margin.top,right:e.margin.right,bottom:e.margin.bottom,left:e.margin.left}},a={legend:null,tooltip:null,data:[],filters:null,svg:{element:null,g:null,xRange:null,yRange:null,xAxis:null,yAxis:null,color:null}},n=this;n.addClass("PAbubblechartContainer");var r={init:function(r){function l(e){a.svg.circle.attr("cx",function(t){return t.x+(f.x-t.x)*(m+.02)*e.alpha}).attr("cy",function(t){return t.y+(f.y-t.y)*(m+.02)*e.alpha})}function i(e){return function(t){t.y+=(t.cy-t.y)*e,t.x+=(t.cx-t.x)*e}}function s(e){var t=d3.geom.quadtree(b);return function(a){var n=a.radius+h.domain()[1]+u,r=a.x-n,l=a.x+n,i=a.y-n,s=a.y+n;t.visit(function(t,n,o,d,p){if(t.point&&t.point!==a){var c=a.x-t.point.x,g=a.y-t.point.y,h=Math.sqrt(c*c+g*g),v=a.radius+t.point.radius+(a.color!==t.point.color)*u;
v>h&&(h=(h-v)/h*e,a.x-=c*=h,a.y-=g*=h,t.point.x+=c,t.point.y+=g)}return n>l||r>d||o>s||i>p})}}function o(){var t=10,n=5,r=a.svg.element.append("g").attr("class","legend").attr("height",100).attr("width",50).attr("transform","translate(0, 40)"),l=r.selectAll(".legend").data(e.data).enter().append("g").attr("class","legend").attr("transform",function(e,r){var l=t+n,i=l*a.svg.color.domain().length/2,s=r*l-i+10;return"translate(150,"+s+")"});l.append("text").attr("opacity",0).transition().duration(500).delay(1e3).attr("opacity",1).attr("x",-23).attr("y",9).style("text","align-right").text(function(e){return e.percentage+"%"}),l.append("circle").attr("opacity",0).transition().duration(500).delay(1e3).attr("cx",n).attr("cy",5).attr("r",5).attr("opacity",1).style("fill",function(e,t){return a.svg.color(t)}).style("stroke",function(e,t){return a.svg.color(t)}),l.append("text").attr("opacity",0).transition().duration(500).delay(1e3).attr("opacity",1).attr("x",15).attr("y",9).text(function(e){return e.device})}var d=n.width()-t.margin.left-t.margin.left,p=n.height()-t.margin.top-t.margin.bottom,c=6,g=1,u=6,h=d3.scale.sqrt().range([0,12]);a.svg.color=d3.scale.category20c().domain(d3.range(g));var v=d3.scale.ordinal().domain(d3.range(g)).rangePoints([0,d],1),f={x:d/3,y:p/2},m=.1,y=d3.max(r,function(e){return e.value}),x=d3.scale.pow().exponent(.5).domain([0,y]).range([1,27]),b=[];r.forEach(function(e){var t;t={id:e.id,value:e.value,percentage:e.percentage,radius:x(e.value),charge:x(e.value),name:e.device,cx:10*Math.random(),cy:10*Math.random(),color:a.svg.color(e.id)},b.push(t)});var A=function(e){return-Math.pow(e.charge,2)/8},C=d3.layout.force().nodes(b).size([.6*d,p]).gravity(.1).charge(A).on("tick",l).start();a.svg.element=d3.selectAll(n.get()).append("svg").attr("width",d).attr("height",p),a.svg.circle=a.svg.element.selectAll("circle").data(b).enter().append("circle").attr("r",function(e){return e.radius}).attr("class",function(e){return"PAbubble-node device-"+e.id}).style("fill",function(e){return e.color}).call(C.drag),o()}};r.init(e.data)},$.fn.PAcounter=function(e){function t(e,t){e.each(function(){if(isNaN($(this).attr("data-value")))$(this).text($(this).attr("data-value"));else{var e=$(this).text("0"),n=setTimeout(function(){e.html(a(1*e.attr("data-value"),e.attr("data-type")))},t+10);$({c:0}).animate({c:e.attr("data-value")},{duration:t,step:function(){var t=this.c;t==e.attr("data-value")&&clearInterval(n),e.html(a(t,e.attr("data-type")))}})}})}function a(e,t){return void 0===t?Number(e).format(n.main.format):Number(e).format(n[t].format)}var n=$.extend(!0,{main:{value:0,format:{decimals:0}},secondary:{value:null,format:{decimals:0},description:null},diff:{value:null,format:{decimals:0},description:null},icon:null},e),r=this;if(r.addClass("PAcounterContainer PAinactive"),r.find(".PAicon, .PAmain, .PAcompare .PAsecondary").remove(),n.icon)var l=$("<span></span>").addClass("PAicon");var i=$("<span></span>").attr("data-value",n.main.value).attr("data-type","main").text(n.main.value).addClass("PAmain PAcount"),s,o;if(n.secondary.value||n.secondary.description){s=$("<div></div>").addClass("PAcount PAcounterContainer PAcontainer"),o=$("<div></div>").addClass("PAcount PAsecondary PAcontainer");var d=$("<span></span>").attr("data-value",n.secondary.value).attr("data-type","secondary").text(n.secondary.value).addClass("PAcount PAsecondary").toggleClass("PAnegative",n.secondary.value<0).toggleClass("PAnull",0==n.secondary.value),p=$("<p></p>").text(n.secondary.description).addClass("PAdescription PAsecondary");l&&r.append(l),r.append(s),s.append(i),s.append(o),(n.secondary.value||0===n.secondary.value)&&o.append(d),n.secondary.description&&o.append(p)}else{var c=$("<div></div>").addClass("PAcount PAmainContainer PAcontainer");r.append(c);var g=null;n.diff.format.after&&!n.diff.value&&(g=$("<div></div>").html(n.diff.format.after).addClass("PAdescription description")),l&&c.append(l),c.append(i),g&&c.append(g)}if(n.icon){var u=$('<img src="'+n.icon+'" />');u.load(function(){l.append(u),t(r.find("span.PAmain"),1e3),t(r.find("span.PAsecondary"),1e3),t(r.next(),1e3),r.removeClass("PAinactive")})}else t(r.find("span.PAmain"),1e3),t(r.find("span.PAsecondary"),1e3),t(r.next(),1e3),r.removeClass("PAinactive");if(n.diff.value||0===n.diff.value){var h;if(n.diff.description){var v=$("<div></div>").addClass("PAcompareContainer");o.append(v),h=$("<span></span>").attr("data-value",n.diff.value).attr("data-type","diff").html(n.diff.value+n.diff.format.after+" ").addClass("PAcompare PAcount").toggleClass("PAnegative",n.diff.value<0).toggleClass("PAnull",0==n.diff.value);var f=$("<span></span>").addClass("PAcompare_description").text(n.diff.description);v.append(h),v.append(f)}else h=$("<span></span>").attr("data-value",n.diff.value).attr("data-type","diff").text(n.diff.value).addClass("PAcompare PAcount").toggleClass("PAnegative",n.diff.value<0).toggleClass("PAnull",0==n.diff.value),r.after(h)}return r},$.fn.PAcounterSimple=function(e,t){var a="number"==typeof e?e:0;"object"==typeof e&&(t=e);var n=$.extend(!0,{number:a,format:{decimals:0},duration:1e3},t),r=this,l=Number(r.attr("data-value"))||0;r.attr("data-value",n.number).removeClass("positive negative"),r.html(Number(l).format(n.format)),n.number>0&&r.addClass("positive"),n.number<0&&r.addClass("negative");var i=setTimeout(function(){r.html(Number(n.number).format(n.format))},n.duration+10);return $({c:l}).animate({c:Number(n.number)},{duration:n.duration,step:function(){var e=this.c;e==Number(n.number)&&clearInterval(i),r.html(Number(e).format(n.format))}}),r},$.fn.PAcustom=function(a){function r(e,t,a,n,r){r||e.html(Number(0).format(a)),setTimeout(function(){e.each(function(){var e=$(this),n=0;r&&(n=parseFloat(e.text())||0);var l=setTimeout(function(){e.html(Number(1*e.attr("data-value")).format(a))},t+10);$({c:n}).animate({c:e.attr("data-value")},{duration:t,step:function(){var t=this.c;t==e.attr("data-value")&&clearInterval(l),e.html(Number(t).format(a))}})})},n||1)}var l=$.extend(!0,{mode:"horizontal_bar",data:[],main:{color:"#88b8c4",format:null},compare:{color:"#808f96",format:null}},a),i=this;i.addClass("PAcustomContainer");var s={horizontal_bar:{init:function(){var a=this;i.addClass("PACustomHBars");var r=l.main.color instanceof Array?l.main.color:[l.main.color],s=i.find("ul").length?d3.selectAll(i.get()).select("ul"):d3.selectAll(i.get()).append("ul"),o=e(l.data),d=Math.abs(o-t(l.data));i.find("ul li:gt("+(l.data.length-1)+")").remove();var p=o/d,c=s.selectAll("li");for(var g in l.data){var u=l.data[g].value;if(u instanceof Object){var h=0;$.each(u,function(e,t){h+=t}),u=h}var v=c[0][g]?d3.select(c[0][g]):s.append("li"),f=d?10+p+(u-(o-d))*((90-p-10)/d):100;if(c[0][g]?(v.select("label").text(l.data[g].label),v.select("div > span").attr("data-perc",f),v.select("span.v").attr("data-value",u)):(v.append("label").text(l.data[g].label),v.append("div").append("span").attr("data-perc",f).style("background",r[0]),v.append("span").classed("v",!0).html(Number(0).format(l.main.format)).attr("data-value",u)),l.data[g].value instanceof Object){var m=v.select("span[data-perc]");m.select("span.container").remove();var y=m.append("span").classed("container",!0),x=100,b=null,A=1;$.each(l.data[g].value,function(e,t){var a=parseInt(t/u*100),l="undefined"==typeof r[A]?n():r[A];x-=a,m.attr("data-"+e,t),b=y.append("span").attr("data-perc",a).attr("data-key",e).style("background",l),A++}),x>0&&b.attr("data-perc",parseInt(b.attr("data-perc"))+x)}}setTimeout(function(){a.animate()},100)},animate:function(){i.find("span[data-perc]").each(function(){$(this).width(parseInt($(this).attr("data-perc"))+"%")}),r(i.find("span[data-value]"),1e3,l.main.format,100,!0)}},gender_distribution_counters:{female_icon:'<svg viewBox="0 0 58 58"><g fill="none"><rect fill="#808F96" x="0" y="0" width="58" height="58" rx="40"></rect><circle stroke="#FFFFFF" stroke-width="2" cx="29" cy="29" r="26.88"></circle><path d="M34.52496,40.79136 C34.49584,40.46992 34.47456,39.9536 34.45776,39.41824 C39.32416,38.91984 42.73792,37.7528 42.73792,36.39312 C42.72448,36.39088 42.7256,36.33712 42.7256,36.31472 C39.08784,33.03648 45.87952,9.73936 33.23584,10.212 C32.44176,9.54 31.05184,8.94304 29.05824,8.94304 C11.93232,10.23888 19.50464,32.23904 15.60256,36.392 C15.60032,36.39312 15.59696,36.39312 15.59472,36.39312 C15.59472,36.39536 15.59584,36.3976 15.59584,36.39984 C15.59584,36.40096 15.59472,36.40208 15.59472,36.40208 C15.59472,36.40208 15.59584,36.40208 15.59696,36.4032 C15.61264,37.73488 18.91104,38.88064 23.63632,39.39136 C23.62288,39.71616 23.59488,40.11824 23.53328,40.79136 C22.09744,44.652 14.62032,44.89392 10.4752,48.7344 C12.74096,50.71232 20.63584,56.02336 29.10528,56.02336 C37.57472,56.02336 44.60832,52.00368 47.4128,48.6224 C43.25872,44.89056 35.94624,44.61392 34.52496,40.79136 L34.52496,40.79136 Z" fill="#FFFFFF"></path></g></svg>',male_icon:'<svg viewBox="0 0 58 58"><g fill="none"><rect fill="#88b8c4" x="0" y="0" width="58" height="58" rx="40"></rect><circle stroke="#FFFFFF" stroke-width="2" cx="29" cy="29" r="26.88"></circle><path d="M34.52496,40.79136 C34.36144,38.98592 34.42416,37.72592 34.42416,36.07616 C35.24176,35.6472 36.70672,32.91216 36.95424,30.6016 C37.59712,30.54896 38.61072,29.92176 38.90752,27.44544 C39.06768,26.116 38.43152,25.36784 38.044,25.13264 C39.09008,21.98656 41.26288,12.25376 34.02544,11.248 C33.28064,9.93984 31.37328,9.27792 28.89472,9.27792 C18.97824,9.46048 17.78208,16.76624 19.956,25.13264 C19.5696,25.36784 18.93344,26.116 19.09248,27.44544 C19.3904,29.92176 20.40288,30.54896 21.04576,30.6016 C21.29216,32.91104 22.81536,35.6472 23.6352,36.07616 C23.6352,37.72592 23.6968,38.98592 23.53328,40.79136 C22.12096,44.58816 14.86784,44.88496 10.68352,48.54624 C15.05824,52.9512 22.14784,56.10176 29.62944,56.10176 C37.11104,56.10176 45.90528,50.19488 47.36912,48.5832 C43.21056,44.88832 35.94064,44.6016 34.52496,40.79136 L34.52496,40.79136 Z" fill="#FFFFFF"></path></g></svg>',init:function(){var e=this;i.addClass("PACustomGenderCounter"),e.structure()},structure:function(){var e=this,t=d3.selectAll(i.get()).append("div").classed("PAdata",!0),a=t.append("p");a.html(e.male_icon).append("span").attr("data-value",0).html(Number(0).format(l.main.format));var n=t.append("p");n.html(e.female_icon).append("span").attr("data-value",0).html(Number(0).format(l.compare.format)),a.select("rect").style("fill",l.main.color),n.select("rect").style("fill",l.compare.color)},animate:function(e){i.find("div.PAdata p:eq(0) > span").attr("data-value",e[0].value),i.find("div.PAdata p:eq(1) > span").attr("data-value",e[1].value),r(i.find("span[data-value]"),1e3,l.main.format,100,!0)}},gender_distribution_v1:{female_icon:'<svg viewBox="0 0 58 58"><g fill="none"><rect fill="#808F96" x="0" y="0" width="58" height="58" rx="40"></rect><circle stroke="#FFFFFF" stroke-width="2" cx="29" cy="29" r="26.88"></circle><path d="M34.52496,40.79136 C34.49584,40.46992 34.47456,39.9536 34.45776,39.41824 C39.32416,38.91984 42.73792,37.7528 42.73792,36.39312 C42.72448,36.39088 42.7256,36.33712 42.7256,36.31472 C39.08784,33.03648 45.87952,9.73936 33.23584,10.212 C32.44176,9.54 31.05184,8.94304 29.05824,8.94304 C11.93232,10.23888 19.50464,32.23904 15.60256,36.392 C15.60032,36.39312 15.59696,36.39312 15.59472,36.39312 C15.59472,36.39536 15.59584,36.3976 15.59584,36.39984 C15.59584,36.40096 15.59472,36.40208 15.59472,36.40208 C15.59472,36.40208 15.59584,36.40208 15.59696,36.4032 C15.61264,37.73488 18.91104,38.88064 23.63632,39.39136 C23.62288,39.71616 23.59488,40.11824 23.53328,40.79136 C22.09744,44.652 14.62032,44.89392 10.4752,48.7344 C12.74096,50.71232 20.63584,56.02336 29.10528,56.02336 C37.57472,56.02336 44.60832,52.00368 47.4128,48.6224 C43.25872,44.89056 35.94624,44.61392 34.52496,40.79136 L34.52496,40.79136 Z" fill="#FFFFFF"></path></g></svg>',male_icon:'<svg viewBox="0 0 58 58"><g fill="none"><rect fill="#88b8c4" x="0" y="0" width="58" height="58" rx="40"></rect><circle stroke="#FFFFFF" stroke-width="2" cx="29" cy="29" r="26.88"></circle><path d="M34.52496,40.79136 C34.36144,38.98592 34.42416,37.72592 34.42416,36.07616 C35.24176,35.6472 36.70672,32.91216 36.95424,30.6016 C37.59712,30.54896 38.61072,29.92176 38.90752,27.44544 C39.06768,26.116 38.43152,25.36784 38.044,25.13264 C39.09008,21.98656 41.26288,12.25376 34.02544,11.248 C33.28064,9.93984 31.37328,9.27792 28.89472,9.27792 C18.97824,9.46048 17.78208,16.76624 19.956,25.13264 C19.5696,25.36784 18.93344,26.116 19.09248,27.44544 C19.3904,29.92176 20.40288,30.54896 21.04576,30.6016 C21.29216,32.91104 22.81536,35.6472 23.6352,36.07616 C23.6352,37.72592 23.6968,38.98592 23.53328,40.79136 C22.12096,44.58816 14.86784,44.88496 10.68352,48.54624 C15.05824,52.9512 22.14784,56.10176 29.62944,56.10176 C37.11104,56.10176 45.90528,50.19488 47.36912,48.5832 C43.21056,44.88832 35.94064,44.6016 34.52496,40.79136 L34.52496,40.79136 Z" fill="#FFFFFF"></path></g></svg>',donutContainer:null,donutForeground:null,init:function(){var e=this;i.hasClass("PACustomGender1")?(e.donutContainer=d3.selectAll(i.get()).select(".PAdonut"),e.donutForeground=d3.selectAll(i.get()).select(".PAdonutForeground")):e.structure(),setTimeout(function(){e.animate(l.data)},100)},structure:function(){var e=this;i.addClass("PACustomGender1"),e.donutContainer=d3.selectAll(i.get()).append("div").classed("PAdonut",!0);var t=d3.selectAll(i.get()).append("div").classed("PAdata",!0),a=t.append("p");a.html(e.male_icon).append("span").attr("data-value",0).html(Number(0).format(l.main.format));var n=t.append("p");n.html(e.female_icon).append("span").attr("data-value",0).html(Number(0).format(l.compare.format)),a.select("rect").style("fill",l.main.color),n.select("rect").style("fill",l.compare.color);var r=10,s=$(e.donutContainer[0]).height(),o=2*Math.PI,d=d3.svg.arc().innerRadius(s/2).outerRadius(s/2).startAngle(0),p=e.donutContainer.append("svg").attr("width",s+2*r).attr("height",s+2*r).append("g").attr("width",s).attr("height",s).attr("transform","translate("+(s/2+r)+","+(s/2+r)+")"),c=p.append("path").datum({endAngle:o}).style("stroke",l.main.color).style("stroke-width",r).attr("d",d);e.donutForeground=p.append("path").classed("PAdonutForeground",!0).datum({endAngle:0}).style("stroke",l.compare.color).style("stroke-width",r).style("opacity",0).style("stroke-linejoin","round").attr("d",d)},animate:function(e){function t(e,t){e.attrTween("d",function(e){var a=d3.interpolate(e.endAngle,t);return function(t){return e.endAngle=a(t),o(e)}})}var a=this;i.find("div.PAdata p:eq(0) > span").attr("data-value",e[0].value),i.find("div.PAdata p:eq(1) > span").attr("data-value",e[1].value),r(i.find("span[data-value]"),1e3,l.main.format,100,!0);var n=$(a.donutContainer[0]).height(),s=2*Math.PI,o=d3.svg.arc().innerRadius(n/2).outerRadius(n/2).startAngle(0);a.donutForeground.style("opacity",1).transition().duration(1e3).call(t,e[1].value/100*s)}},age_distribution:{male_icon:'<svg viewBox="0 0 17 15"><path d="M14.0801524,14.4567109 C15.7050178,12.9316006 16.7199993,10.764331 16.7199993,8.35999966 C16.7199993,3.74289934 12.9771,0 8.35999966,0 C3.74289934,0 0,3.74289934 0,8.35999966 C0,10.7678635 1.01796621,12.9379685 2.64701267,14.4634289 C2.65246531,14.4552179 2.65791339,14.4471119 2.66335656,14.4391127 C3.96472984,13.3004111 6.22053641,13.2081028 6.65978473,12.0272528 C6.71064139,11.4657395 6.69148306,11.0738645 6.69148306,10.5607696 C6.43650307,10.4273579 5.96276976,9.57637961 5.88613642,8.8581163 C5.6861931,8.84174464 5.37129978,8.64667798 5.27864312,7.87651301 C5.22917979,7.46304136 5.42703311,7.2303547 5.54720811,7.15720471 C4.87109313,4.55515481 5.24311312,2.28297657 8.32725632,2.22619824 C9.09811796,2.22619824 9.6913296,2.43206323 9.92297126,2.83891655 C12.1739012,3.15171987 11.4981345,6.17873641 11.1727912,7.15720471 C11.2933145,7.2303547 11.4911679,7.46304136 11.4413562,7.87651301 C11.3490479,8.64667798 11.0338062,8.84174464 10.8338629,8.8581163 C10.7568812,9.57672794 10.3012612,10.4273579 10.0469779,10.5607696 C10.0469779,11.0738645 10.0274713,11.4657395 10.0783279,12.0272528 C10.5186212,13.2122828 12.7796528,13.3014561 14.0730144,14.4506077 C14.0753917,14.4526194 14.077771,14.4546538 14.0801524,14.4567109 Z"></path></svg>',female_icon:'<svg viewBox="0 0 17 15"><path d="M14.0799816,14.4559844 C15.7049466,12.9309593 16.7199993,10.7637549 16.7199993,8.35948679 C16.7199993,3.74266972 12.9771,0 8.35999966,0 C3.74289934,0 0,3.74266972 0,8.35948679 C0,10.7645778 1.0157477,12.9324428 2.64168654,14.4575501 C3.93892102,13.3005812 6.21815684,13.2138769 6.65978473,12.026515 C6.67894306,11.8171795 6.68765139,11.6921355 6.69183139,11.5911251 C5.22221312,11.4322948 4.19637149,11.0759717 4.19323649,10.6583457 C5.40682978,9.36680495 3.05174821,2.52491332 8.37811299,2.1219164 C8.9981463,2.1219164 9.43042795,2.30756667 9.67739627,2.51655384 C13.6097311,2.36956619 11.4974379,9.61480306 12.6326561,10.658694 C12.6326561,11.0815447 11.5709362,11.4444857 10.0574279,11.5994845 C10.0626529,11.7659777 10.0692713,11.9265495 10.0783279,12.026515 C10.5196091,13.2132765 12.7868802,13.3010401 14.0799816,14.4559844 Z"></path></svg>',init:function(){var e=this;i.addClass("PACustomAgeDist");var t=d3.selectAll(i.get()).append("ul"),a=d3.selectAll(i.get()).append("div").classed("PAdetail hide",!0),n=a.append("p").classed("PAmale",!0).html(e.male_icon).style("color",l.main.color),s=n.append("label"),o=a.append("p").classed("PAfemale",!0).html(e.female_icon).style("color",l.compare.color),d=o.append("label"),p=0,c=100;for(var g in l.data){var u=l.data[g].value.m+l.data[g].value.f;p=u>p?u:p,c=c>u?u:c}var h=Math.abs(p-c)/50;for(var g in l.data){var v=t.append("li").attr("data-male",l.data[g].value.m).attr("data-female",l.data[g].value.f),f=l.data[g].value.m+l.data[g].value.f;if(f>0){v.append("label").text(l.data[g].label);var m=v.append("div").append("span").attr("data-perc",f/h).style("background",l.main.color),y=l.data[g].value.f/f;m.append("span").classed("PAhide",!0).attr("data-perc",100*y).style("background",l.compare.color),v.append("span").html(Number(f).format(l.main.format)).attr("data-value",f)}}i.on("click","li",function(){var e=$(this).find("span > span");i.find("li span > span").not(e).addClass("PAhide"),e.toggleClass("PAhide"),i.find("div.PAdetail").toggleClass("hide",0==i.find("li span > span:not(.PAhide)").length);var t=1*$(this).attr("data-male"),a=1*$(this).attr("data-female"),n=t/(t+a)*100;s.attr("data-value",n),d.attr("data-value",100-n),r(i.find("div.PAdetail label[data-value]"),1e3,l.main.format,null,!0)})},animate:function(e){var t=0,a=100;for(var n in e){var s=e[n].value.m+e[n].value.f;t=s>t?s:t,a=a>s?s:a}var o=Math.abs(t-a)/50;d3.selectAll(i.get()).selectAll("li:nth-child(n+"+parseInt(e.length+1)+")").transition().duration(300).style("opacity","0").delay(300).remove();var d=d3.selectAll(i.get()).selectAll("ul li");for(var n in e){var p=d3.select(d[0][n]),c=e[n].value.m+e[n].value.f;if(!p[0][0]){var p=d3.selectAll(i.get()).select("ul").append("li");if(c>0){p.append("label");var g=p.append("div").append("span").style("background",l.main.color),u=e[n].value.f/(e[n].value.m+e[n].value.f);g.append("span").classed("PAhide",!0).style("background",l.compare.color),p.append("span").html(Number(c).format(l.main.format))}}p.attr("data-male",e[n].value.m).attr("data-female",e[n].value.f),p.select("label").text(e[n].label);var u=e[n].value.f/c*100;p.select("div > span").attr("data-perc",c/o).select("span").classed("PAhide",!0).attr("data-perc",u),p.select("span[data-value]").attr("data-value",c),i.find("div.PAdetail").addClass("hide")}i.find("span[data-perc]").each(function(){$(this).width(parseInt($(this).attr("data-perc"))+"%")}),r(i.find("span[data-value]"),1e3,l.main.format,null,!0)}},age_and_gender_distribution:{male_icon:'<svg viewBox="0 0 17 15"><path d="M14.0801524,14.4567109 C15.7050178,12.9316006 16.7199993,10.764331 16.7199993,8.35999966 C16.7199993,3.74289934 12.9771,0 8.35999966,0 C3.74289934,0 0,3.74289934 0,8.35999966 C0,10.7678635 1.01796621,12.9379685 2.64701267,14.4634289 C2.65246531,14.4552179 2.65791339,14.4471119 2.66335656,14.4391127 C3.96472984,13.3004111 6.22053641,13.2081028 6.65978473,12.0272528 C6.71064139,11.4657395 6.69148306,11.0738645 6.69148306,10.5607696 C6.43650307,10.4273579 5.96276976,9.57637961 5.88613642,8.8581163 C5.6861931,8.84174464 5.37129978,8.64667798 5.27864312,7.87651301 C5.22917979,7.46304136 5.42703311,7.2303547 5.54720811,7.15720471 C4.87109313,4.55515481 5.24311312,2.28297657 8.32725632,2.22619824 C9.09811796,2.22619824 9.6913296,2.43206323 9.92297126,2.83891655 C12.1739012,3.15171987 11.4981345,6.17873641 11.1727912,7.15720471 C11.2933145,7.2303547 11.4911679,7.46304136 11.4413562,7.87651301 C11.3490479,8.64667798 11.0338062,8.84174464 10.8338629,8.8581163 C10.7568812,9.57672794 10.3012612,10.4273579 10.0469779,10.5607696 C10.0469779,11.0738645 10.0274713,11.4657395 10.0783279,12.0272528 C10.5186212,13.2122828 12.7796528,13.3014561 14.0730144,14.4506077 C14.0753917,14.4526194 14.077771,14.4546538 14.0801524,14.4567109 Z"></path></svg>',female_icon:'<svg viewBox="0 0 17 15"><path d="M14.0799816,14.4559844 C15.7049466,12.9309593 16.7199993,10.7637549 16.7199993,8.35948679 C16.7199993,3.74266972 12.9771,0 8.35999966,0 C3.74289934,0 0,3.74266972 0,8.35948679 C0,10.7645778 1.0157477,12.9324428 2.64168654,14.4575501 C3.93892102,13.3005812 6.21815684,13.2138769 6.65978473,12.026515 C6.67894306,11.8171795 6.68765139,11.6921355 6.69183139,11.5911251 C5.22221312,11.4322948 4.19637149,11.0759717 4.19323649,10.6583457 C5.40682978,9.36680495 3.05174821,2.52491332 8.37811299,2.1219164 C8.9981463,2.1219164 9.43042795,2.30756667 9.67739627,2.51655384 C13.6097311,2.36956619 11.4974379,9.61480306 12.6326561,10.658694 C12.6326561,11.0815447 11.5709362,11.4444857 10.0574279,11.5994845 C10.0626529,11.7659777 10.0692713,11.9265495 10.0783279,12.026515 C10.5196091,13.2132765 12.7868802,13.3010401 14.0799816,14.4559844 Z"></path></svg>',init:function(){var e=this;i.addClass("PACustomAgeDist PACustomGenderDist");var t=d3.selectAll(i.get()).append("ul"),a=d3.selectAll(i.get()).append("div").classed("PAdata",!0),n=a.append("p");n.html(e.male_icon).append("span").attr("data-value",0).html(Number(0).format(l.main.format));var s=a.append("p");s.html(e.female_icon).append("span").attr("data-value",0).html(Number(0).format(l.compare.format)),n.select("path").style("fill",l.main.color),s.select("path").style("fill",l.compare.color);var o=0,d=100;for(var p in l.data){var c=l.data[p].value.m+l.data[p].value.f;d=c>d?c:d,o=o>c?c:o}var g=Math.abs(d-o)/50;for(var p in l.data){var u=t.append("li").attr("data-male",l.data[p].value.m).attr("data-female",l.data[p].value.f),h=l.data[p].value.m+l.data[p].value.f;if(h>0){u.append("label").text(l.data[p].label);var v=u.append("div").append("span").attr("data-perc",h/g).style("background",l.main.color),f=l.data[p].value.f/h;v.append("span").classed("PAhide",!0).attr("data-perc",100*f).style("background",l.compare.color),u.append("span").html(Number(h).format(l.main.format)).attr("data-value",h)}}i.find("li").hover(function(){var t=$(this).find("span > span");t.removeClass("PAhide"),i.find("div.PAdetail").toggleClass("hide",0==i.find("li span > span:not(.PAhide)").length);var a=1*$(this).attr("data-male"),n=1*$(this).attr("data-female"),s=a/(a+n)*100,o={m:s,f:100-s};e.animate_gender_dist(o),r(i.find("div.PAdetail label[data-value]"),400,l.main.format,null,!0)},function(){var t=$(this).find("span > span");t.addClass("PAhide"),i.find("div.PAdetail").toggleClass("hide",0==i.find("li span > span:not(.PAhide)").length);for(var a=$(this).closest("ul"),n=a.find("li").toArray(),s=0,o=0,d=0;d<n.length;d++)o+=parseFloat(n[d].dataset.female),s+=parseFloat(n[d].dataset.male);var p=s/(s+o)*100,c={m:p,f:100-p};e.animate_gender_dist(c),r(i.find("div.PAdetail label[data-value]"),400,l.main.format,null,!0)})},animate_gender_dist:function(e){i.find("div.PAdata p:eq(0) > span").attr("data-value",e.m),i.find("div.PAdata p:eq(1) > span").attr("data-value",e.f),r(i.find("span[data-value]"),300,l.main.format,100,!0)},animate:function(e){for(var t=0,a=0,n=0,s=0;s<e.length;s++)t+=e[s].value.f,a+=e[s].value.m,n+=e[s].value.m,n+=e[s].value.f;var o=t/n*100;i.find("div.PAdata p:eq(0) > span").attr("data-value",100-o),i.find("div.PAdata p:eq(1) > span").attr("data-value",o),r(i.find("span[data-value]"),1e3,l.main.format,100,!0);var d=0,p=100;for(var c in e){var g=e[c].value.m+e[c].value.f;d=g>d?g:d,p=p>g?g:p}var u=Math.abs(d-p)/50;d3.selectAll(i.get()).selectAll("li:nth-child(n+"+parseInt(e.length+1)+")").transition().duration(300).style("opacity","0").delay(300).remove();var h=d3.selectAll(i.get()).selectAll("ul li");for(var c in e){var v=d3.select(h[0][c]),f=e[c].value.m+e[c].value.f;if(!v[0][0]){var v=d3.selectAll(i.get()).select("ul").append("li");if(f>0){v.append("label");var m=v.append("div").append("span").style("background",l.main.color),y=e[c].value.f/(e[c].value.m+e[c].value.f);m.append("span").classed("PAhide",!0).style("background",l.compare.color),v.append("span").html(Number(f).format(l.main.format))}}v.attr("data-male",e[c].value.m).attr("data-female",e[c].value.f),v.select("label").text(e[c].label);var y=e[c].value.f/f*100;v.select("div > span").attr("data-perc",f).select("span").classed("PAhide",!0).attr("data-perc",y),v.select("span[data-value]").attr("data-value",f),i.find("div.PAdetail").addClass("hide")}i.find("span[data-perc]").each(function(){$(this).width(parseInt($(this).attr("data-perc"))+"%")}),r(i.find("span[data-value]"),1e3,l.main.format,null,!0)}}};return s[l.mode].init(),i.animate=function(e){s[l.mode].animate(e)},i}}(jQuery),String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},Number.prototype.format=function(e){function t(e){var t=[{value:1e18,symbol:"E"},{value:1e15,symbol:"P"},{value:1e12,symbol:"T"},{value:1e9,symbol:"G"},{value:1e6,symbol:"M"},{value:1e3,symbol:"k"}],a;for(a=0;a<t.length;a++)if(e>=t[a].value)return{number:parseFloat((e/t[a].value).toFixed(10).replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1")),symbol:t[a].symbol};return{number:parseFloat(e),symbol:""}}if(!e)return this.valueOf();var a=parseFloat(this.valueOf()),n=e.after||"";if(e.trimK){var r=t(this);a=r.number,n=r.symbol+n}var l="\\d(?=(\\d{3})+"+(e.decimals>0?"\\D":"$")+")",a=a.toFixed(Math.max(0,~~e.decimals)),i=(e.decimal?a.replace(".",e.decimal):a).replace(new RegExp(l,"g"),"$&"+(e.thousand||""));return(e.before||"")+i+n};