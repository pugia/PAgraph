!function(a){function b(b,c){return void 0==c&&(c="value"),Math.max.apply(null,Object.keys(b).map(function(d){var e=b[d][c];if(e instanceof Object){var f=0;a.each(e,function(a,b){f+=b}),e=f}return e}))}function c(b,c){return void 0==c&&(c="value"),Math.min.apply(null,Object.keys(b).map(function(d){var e=b[d][c];if(e instanceof Object){var f=0;a.each(e,function(a,b){f+=b}),e=f}return e}))}function d(){return"#"+(16777215*Math.random()<<0).toString(16)}a.fn.PAgraph=function(d){function e(a,d){var d=d||5,e=1,f=b(a),g=j.config.stacked?0:c(a);if(1.5>=f&&(e=10),d>=f-g&&(e=1),g*=e,f*=e,g==f)return Array.apply(null,Array(d+1)).map(function(a,b){return g+10*(b-1)});if(f-g>d){var h=g?Math.ceil(.05*(f-g)):0,i=Math.ceil(.05*(f-g));g-=h,f+=i;var k=Math.round((f-g)/d),l=10*(k.toString().length-1)||1,m=Math.round(2*k/l)/2*l}else var k=(f-g)/d,m=k,e=1;for(var n=Math.floor(g/m)*m/e,o=[],p=0;d>=p;p++)o.push(Number(n)),n+=m/e;return o}function f(a){var b=[];for(var c in a)for(var d in a[c])b.push(a[c][d]);return b}function g(b){var c=a.extend(!0,null,b),d=[];return a.each(c,function(b,c){a.each(c,function(a,c){0===+b?d[a]=c:j.config.stacked?d[a].value+=c.value:d.push(c)})}),d}function h(){j.debug&&console.debug(arguments)}var j=a.extend(!0,{mode:"history",filter:{mode:"daily",labels:["daily","weekly","monthly"],limits:{daily:28,enable_weekly:40,enable_monthly:60,disable_weekly:120}},config:{graph:[],grid:{x:{show:!0,color:"#E2E6E9",label:"#C1C1C1",format:function(a){return a}},y:{show:!0,color:"#C6CED3",label:"#C1C1C1",format:null}},spacing:10,stacked:!1,rectRadius:5},lineInterpolation:"cardinal",interpolateOnZero:!0,preFetch:null},d),k=this;k.addClass("PAgraphContainer");var l={legend:null,tooltip:null,data:[],filters:null,svg:{element:null,grid:{group:null,x:{group:null,elements:[]},y:{group:null,elements:[]}},label:{x:{group:null,elements:[]},y:{group:null,spacing:[],elements:[]}},graph:{group:null,elements:[],circles:null}}},m={group:null,elements:{line:null,area:null,points:{coords:[],elements:[]}}},n={labels:{x:{height:30,marginTop:15},y:{width:60,marginLeft:10}},graphAnimationTime:600,animateGridTime:500,animateEasing:"cubic-in-out",graphLineInterpolation:j.lineInterpolation};l.legend=d3.selectAll(k.get()).append("div").classed("PAlegend",!0),l.tooltip=d3.selectAll(k.get()).append("div").classed("PAtooltip",!0),l.tooltip.append("span").classed("time",!0).text(""),l.tooltip.append("span").classed("metric",!0).text(""),l.tooltip.append("label").text(""),l.svg.element=d3.selectAll(k.get()).append("svg").classed("PAGraph",!0).classed("PAMode"+j.mode.capitalizeFirstLetter(),!0).attr("width",k.width()).attr("height",k.height()),l.svg.grid.group=l.svg.element.append("g").classed("PAGgrid",!0),l.svg.label.x.group=l.svg.element.append("g").classed("PAGlabelX",!0),l.svg.label.y.group=l.svg.element.append("g").classed("PAGlabelY",!0),l.svg.graph.group=l.svg.element.append("g").classed("PAGgraphs",!0),l.svg.graph.circles=l.svg.element.append("g").classed("PAGcircles",!0);var o=k.width(),p=k.height(),q=null;a(window).on("resize",function(){clearTimeout(q),q=setTimeout(function(){k.width()==o&&k.height()==p||(k.width()!=o&&(o=k.width(),l.svg.element.attr("width",k.width())),k.height()!=p&&(p=k.height(),l.svg.element.attr("height",k.height())),k.draw())},100)});var r={history:{filter:"daily",computedData:[null,null],filledEdges:!1,init:function(){h("MODE: history");var a=this;a.initLegend(),a.initCircles(),a.initFilters(),a.grid()},grid:function(){var a=this;a.initGridX(),a.initGridY()},initGridX:function(){var a=k.width(),b=k.height(),c=0,d=8;j.config.grid.x.label!==!1&&(b-=n.labels.x.height),j.config.grid.y.label!==!1&&(c=n.labels.y.width,a-=c);var e=a/(d-1);l.svg.grid.group.selectAll("g.PAGgridX line").remove(),l.svg.grid.x.group=l.svg.grid.group.append("g").classed("PAGgridX",!0);for(var f=0;d>f;f++){var g=f*e+c,h=l.svg.grid.x.group.append("line").attr("x1",g).attr("y1",0).attr("x2",g).attr("y2",b).attr("stroke",j.config.grid.x.color);l.svg.grid.x.elements.push(h)}},initGridY:function(){var a=k.width(),b=k.height(),c=0;j.config.grid.x.label!==!1&&(b-=n.labels.x.height),j.config.grid.y.label!==!1&&(c=n.labels.y.width,a-=c);var d=6,e=Math.floor(b/d);l.svg.grid.group.selectAll("g.PAGgridY line").remove(),l.svg.grid.y.group=l.svg.grid.group.append("g").classed("PAGgridY",!0);for(var f=0;d>f;f++){var g=l.svg.grid.y.group.append("line").attr("x1",c).attr("y1",b-f*e).attr("x2",k.width()).attr("y2",b-f*e).attr("stroke",j.config.grid.y.color);l.svg.grid.y.elements.push(g)}},initGraph:function(b,c,d,e){var f=a.Deferred();if(b&&l.svg.graph.elements[b])return f.resolve(b),f.promise();var g=k.width(),h=k.height(),i=0,o=a.extend(!0,{},m);o.group=l.svg.graph.group.insert("g",":first-child").classed("PAGgraph",!0),l.svg.graph.elements.push(o);var p=l.svg.graph.elements.length-1;l.svg.graph.elements[p].group.attr("data-index",p),c=c||"#"+((1<<24)*Math.random()|0).toString(16),d=d||"Graph "+p,e=e||null,j.config.graph.push({color:c,legend:d,format:e});var q=l.svg.grid.x.elements.length||8;l.svg.element.attr("data-points",q),j.config.grid.x.label!==!1&&(h-=n.labels.x.height),j.config.grid.y.label!==!1&&(i=n.labels.y.width);for(var r=g/(q-1),s=[],t=0;q>t;t++){var u=t*r+i;s.push({x:u,y:h})}var v=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate(n.graphLineInterpolation),w=v(s),x=l.svg.graph.elements[p].group.append("path").classed("PAGgraphLine",!0).attr("d",w).attr("stroke",j.config.graph[p].color).attr("stroke-width",1).attr("fill","none");l.svg.graph.elements[p].elements.line=x;var y=l.svg.graph.elements[p].group.append("path").classed("PAGgraphArea",!0).attr("d",w).attr("stroke-width",0).attr("fill",j.config.graph[p].color);l.svg.graph.elements[p].elements.area=y;var z=l.legend.append("p").attr("data-index",p);return z.append("span").style("background",j.config.graph[p].color),z.append("label").text(j.config.graph[p].legend),setTimeout(function(){f.resolve(p)},25*q),f.promise()},initLegend:function(){var b=this;k.find("div.PAlegend").addClass("PAhide").on("click","p[data-index]",function(){var c=parseInt(a(this).attr("data-index"));b.moveOnFront(c)})},initFilters:function(){var b=this;l.filters=d3.selectAll(k.get()).insert("div",":first-child").classed("PAfilters",!0),l.filters.append("p").attr("data-mode","daily").text(j.filter.labels[0]),l.filters.append("p").attr("data-mode","weekly").text(j.filter.labels[1]),l.filters.append("p").attr("data-mode","monthly").text(j.filter.labels[2]),k.find("div.PAfilters").addClass("PAhide").on("click","p[data-mode]",function(){j.filter.mode=a(this).attr("data-mode"),b.applyFilter()})},setData:function(b,c){var d=this,g=a.Deferred();if(c=c||0,l.data[0]&&l.data.length&&0===+c&&l.data[0].length!=b.length&&(l.data=[],d.computedData=[]),b&&0!==b.length||g.reject("no"),0!==c&&l.data[0]&&l.data[0].length!=b.length)console.log("Compare metric has a different scale"),g.reject("no");else{d.filledEdges=!1,1==b.length&&(b.splice(0,null,{label:"",value:0}),b.splice(2,null,{label:"",value:0}),d.filledEdges=!0),l.data[c]=b,0===+c&&(l.filters.classed("PAhide",!0),j.filter.limits&&(l.data[0].length>=j.filter.limits.daily?(l.data[0].length>j.filter.limits.enable_weekly&&"daily"==j.filter.mode&&(j.filter.mode="weekly"),l.filters.select('p[data-mode="daily"]').classed("PAhide",l.data[0].length>j.filter.limits.enable_monthly),l.filters.select('p[data-mode="monthly"]').classed("PAhide",l.data[0].length<j.filter.limits.disable_weekly),l.data[0].length<j.filter.limits.disable_weekly&&"monthly"==j.filter.mode&&(j.filter.mode="daily"),l.filters.selectAll("p").classed("selected",!1),l.filters.select('p[data-mode="'+j.filter.mode+'"]').classed("selected",!0),(l.data[0].length<j.filter.limits.enable_monthly||l.data[0].length>=j.filter.limits.disable_weekly)&&setTimeout(function(){l.filters.classed("PAhide",!1)},n.animateGridTime)):(j.filter.mode="daily",l.filters.selectAll("p").classed("selected",!1),l.filters.select('p[data-mode="'+j.filter.mode+'"]').classed("selected",!0)))),d.computedData[c]=d.applyFilterToData(b,j.filter.mode);var h=f(d.computedData);l.svg.grid.y.spacing=e(h),setTimeout(function(){g.resolve("ok")},10)}return g.promise()},draw:function(){var b=this;if(b.computedData[0]){if(b.initGridY(),k.trigger({type:"draw",mode:j.filter.mode,computedData:b.computedData}),promises=[],promises.push(b.animateGridX(b.computedData[0])),promises.push(b.animateLabelY(b.computedData[0])),parseInt(l.svg.element.attr("data-points"))!=b.computedData[0].length)for(var c in l.svg.graph.elements)promises.push(b.flattenGraph(c));a.when.apply(a,promises).done(function(){k.find("div.PAlegend").toggleClass("PAhide",b.computedData.length<2),l.svg.element.attr("data-points",b.computedData[0].length);for(var a in l.svg.graph.elements)b.computedData[a]?b.animateGraph(b.computedData[a],a):b.removeGraph(a)})}},removeGraph:function(b){var c=this,d=a.Deferred();return b=b||l.data.length-1,a.when(c.flattenGraph(b)).done(function(){0===+b?d.reject():(l.svg.graph.elements[b].group.remove(),l.svg.graph.elements.splice(b,1),k.find("div.PAlegend > p[data-index="+b+"]").remove(),delete l.data[b],c.computedData[b]=null,d.resolve())}).fail(function(){d.resolve()}),d.promise()},applyFilter:function(){var a=this;l.filters.selectAll("p").classed("selected",!1),l.filters.select('p[data-mode="'+j.filter.mode+'"]').classed("selected",!0),a.computedData[0]=a.applyFilterToData(l.data[0],j.filter.mode),a.computedData[1]=a.applyFilterToData(l.data[1],j.filter.mode);var b=f(a.computedData);l.svg.grid.y.spacing=e(b),a.draw()},animateGraph:function(a,c){var d=this;if(!l.svg.graph.elements[c])return void console.log("structure not exist");var e=k.width(),f=k.height(),g=0;j.config.grid.x.label!==!1&&(f-=n.labels.x.height),j.config.grid.y.label!==!1&&(g=n.labels.y.width,e-=g);var h=1==a.length?e/2:e/(a.length-1),i=Math.floor(f/6)/(l.svg.grid.y.spacing[1]-l.svg.grid.y.spacing[0]);l.svg.graph.circles.selectAll("circle").classed("PAhide","true"),setTimeout(function(){l.svg.graph.circles.selectAll("circle.PAhide").remove()},300);var m=[],o=(m.length,[]),p=[];for(var q in a){var r=q*h+g,s=parseInt(f-(a[q].value-l.svg.grid.y.spacing[0])*i);o.push({x:r,y:s}),j.interpolateOnZero||(p.push({x:r,y:s}),0===+a[q].value&&(m.push(p),p=[],p.push({x:r,y:s})))}m.length||m.push(o),l.svg.graph.elements[c].elements.points.coords=o;var t=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate(n.graphLineInterpolation),u="";if(j.interpolateOnZero)u=t(o);else{for(var v in m)u+=t(m[v]);var w=/M(.\d*),(.\d*)/,x=w.exec(u)[0];u=x+u.replace(/M(.\d*),(.\d*)/gim,"")}pathCoordArea=u,pathCoordArea+="L"+b(o,"x")+","+f,pathCoordArea+="L"+g+","+f,pathCoordArea+="L"+g+","+o[0].y,l.svg.graph.elements[c].elements.area.transition().duration(n.graphAnimationTime).attr("d",pathCoordArea).ease(n.animateEasing),l.svg.graph.elements[c].elements.line.transition().duration(n.graphAnimationTime).attr("d",u).ease(n.animateEasing).each("end",function(){d.animateCircles(a,c)})},flattenGraph:function(c){var d=this;h("flattenGraph",c);var e=a.Deferred(),f=k.width(),g=k.height(),i=0;if(!l.svg.graph.elements[c])return e.reject(),e.promise();var m=parseInt(l.svg.element.attr("data-points"));j.config.grid.x.label!==!1&&(g-=n.labels.x.height),j.config.grid.y.label!==!1&&(i=n.labels.y.width,f-=i);for(var o=f/(m-1),p=[],q=0;m>q;q++){var r=q*o+i;p.push({x:r,y:g})}var s=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate(n.graphLineInterpolation),t=s(p);if(pathCoordArea=t,pathCoordArea+="L"+b(p,"x")+","+(g+1),pathCoordArea+="L"+i+","+(g+1),pathCoordArea+="L"+i+","+p[0].y,d.computedData[c]&&d.computedData[c].length){var u=Math.floor(f/(d.computedData[c].length-1));for(p=[],q=0;q<d.computedData[c].length;q++){var v=q*u+i;p.push({x:v,y:g})}s=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate(n.graphLineInterpolation);var w=s(p);pathCoordAreaNext=w,pathCoordAreaNext+="L"+b(p,"x")+","+(g+1),pathCoordAreaNext+="L"+i+","+(g+1),pathCoordAreaNext+="L"+i+","+p[0].y}return l.svg.graph.circles.selectAll("circle").transition().duration(n.graphAnimationTime).attr("cy",g).style("opacity",0).remove(),l.svg.graph.elements[c].elements.area.transition().duration(n.graphAnimationTime).attr("d",pathCoordArea).ease(n.animateEasing).each("end",function(){d3.select(this).attr("d",pathCoordAreaNext)}),l.svg.graph.elements[c].elements.line.transition().duration(n.graphAnimationTime).attr("d",t).ease(n.animateEasing).each("end",function(){d3.select(this).attr("d",w),e.resolve()}),e.promise()},animateGridX:function(b){var c=this;h("animateGridX");var d=a.Deferred();c.animateLabelX(b);var e=k.width(),f=k.height(),g=0;if(b){var i=b.length;j.config.grid.x.label!==!1&&(f-=n.labels.x.height),j.config.grid.y.label!==!1&&(g=n.labels.y.width,e-=g);var m=e/(i-1);if(i>l.svg.grid.x.elements.length)for(var o=i-l.svg.grid.x.elements.length,p=0;o>p;p++){var q=l.svg.grid.x.group.append("line").attr("x1",e+g+50).attr("y1",0).attr("x2",e+g+50).attr("y2",f).attr("stroke",j.config.grid.x.color).attr("data-count",p);l.svg.grid.x.elements.push(q)}for(var r in l.svg.grid.x.elements){var s=r*m+g;l.svg.grid.x.elements[r].transition().duration(n.animateGridTime).attr("x1",s).attr("x2",s).ease(n.animateEasing)}return setTimeout(function(){if(i<l.svg.grid.x.elements.length){for(var a=l.svg.grid.x.elements.length-i,b=0;a>b;b++){var c=b+i;l.svg.grid.x.elements[c].remove()}l.svg.grid.x.elements.splice(i,a)}d.resolve()},n.animateGridTime),d.promise()}},animateLabelX:function(b){var c=this,d=a.Deferred(),e=k.width(),f=k.height(),g=0;if(b){var h=b.length;j.config.grid.x.label&&(f-=n.labels.x.height),j.config.grid.y.label&&(g=n.labels.y.width,e-=g);var i=e/(b.length-1);if(l.svg.label.x.group.classed("PAhide",!0).selectAll("text").classed("PAhide",!1),setTimeout(function(){for(var a in b){var c=a*i+g;if(l.svg.label.x.elements[a])l.svg.label.x.elements[a].attr("x",c).text(j.config.grid.x.format(b[a].label)).attr("text-anchor","middle");else{var d=l.svg.label.x.group.append("text").attr("x",c).attr("y",f+n.labels.x.marginTop).attr("text-anchor","middle").attr("fill",j.config.grid.x.label).text(j.config.grid.x.format(b[a].label));l.svg.label.x.elements.push(d)}}l.svg.label.x.elements[0].attr("text-anchor","start"),l.svg.label.x.elements[a].attr("text-anchor","end")},n.animateGridTime),h<l.svg.label.x.elements.length){for(var m=l.svg.grid.x.elements.length-h,o=0;m>o;o++){var p=o+h;l.svg.label.x.elements[p]&&l.svg.label.x.elements[p].remove()}l.svg.label.x.elements.splice(h,m)}return setTimeout(function(){l.svg.label.x.group.classed("PAhide",!1),c.hideThickLabels(),d.resolve()},2*n.animateGridTime),d}},hideThickLabels:function(){var a=l.svg.label.x.group.select("text:nth-child(2)")[0][0].getBBox().width,b=parseFloat(l.svg.label.x.group.select("text:nth-child(1)").attr("x")),c=1;l.svg.label.x.group.selectAll("text:nth-child(n+2)").each(function(){var d=parseFloat(d3.select(this).attr("x"))-a/2;return d>b+a?!1:void c++}),c>1&&l.svg.label.x.group.selectAll("text:not(:nth-child("+c+"n+1))").classed("PAhide",!0)},animateLabelY:function(a){h("animateLabelY");var b=k.width(),c=k.height(),d=0;if(a){j.config.grid.x.label&&(c-=n.labels.x.height),j.config.grid.y.label&&(d=n.labels.y.width,b-=d);var e=6,f=Math.floor(c/e);l.svg.label.y.group.classed("PAhide",!0),setTimeout(function(){for(var a=0;e>a;a++)if(l.svg.label.y.elements[a])l.svg.label.y.elements[a].text(Number(l.svg.grid.y.spacing[a]).format(j.config.grid.y.format));else{var b=l.svg.label.y.group.append("text").attr("x",50).attr("y",c-a*f).attr("text-anchor","end").attr("fill",j.config.grid.y.label).text(Number(l.svg.grid.y.spacing[a]).format(j.config.grid.y.format));l.svg.label.y.elements.push(b)}},n.animateGridTime),setTimeout(function(){l.svg.label.y.group.classed("PAhide",!1)},2*n.animateGridTime)}},animateCircles:function(a,b){var c=this;for(var d in l.svg.graph.elements[b].elements.points.coords){var e=!0;if(!c.filledEdges||0!==+d&&d!=l.svg.graph.elements[b].elements.points.coords.length-1||(e=!1),e){var f=l.svg.graph.elements[b].elements.points.coords[d],g=l.svg.graph.circles.append("circle").attr("cx",f.x).attr("cy",f.y).attr("r",0).attr("stroke-width",2).attr("stroke",j.config.graph[b].color).attr("fill","#fff").attr("data-value",a[d].value).attr("data-index",b).attr("rel",d).transition().delay(20*d).attr("r",2).ease(n.animateEasing);l.svg.graph.elements[b].elements.points.elements.push(g)}}},setLegendLabel:function(a,b){j.config.graph[b].legend=a,l.legend.select('p[data-index="'+b+'"] > label').text(a)},initCircles:function(){var b=null;k.on("mouseover","circle",function(){l.tooltip.style("display","block"),clearTimeout(b);var c=a(this).attr("data-index"),d=a(this).attr("data-value"),e=a(this).attr("rel"),f=k.find("g.PAGlabelX > text:eq("+e+")").text();l.tooltip.select("span.time").text(f).style("background-color",j.config.graph[c].color),l.tooltip.style("color",j.config.graph[c].color).select("span.metric").html(Number(d).format(j.config.graph[c].format)),l.tooltip.select("label").text(j.config.graph[c].legend);var g=(l.tooltip.node().getBoundingClientRect(),a(l.tooltip[0][0])),h=g.width(),i=g.height(),m=a(this).attr("cx"),n=a(this).attr("cy"),o=n-i-20,p=m-parseInt(h/2)-10;g.css("top",o).css("left",p).addClass("show")}).on("mouseout","circle",function(){l.tooltip.classed("show",!1),b=setTimeout(function(){l.tooltip.style("display","none")},300)})},moveOnFront:function(a){var b=k.find("g.PAGgraphs");b.find("g.PAGgraph[data-index="+a+"]").appendTo(b)},applyFilterToData:function(b,c){function d(a){return a}function e(b){var c=[],d={label:"",value:0},e={},f=0;for(var g in b)g%7===0&&(e=a.extend(!0,{},d),e.label=b[g].label,c.push(e),f=c.length-1),c[f].value+=b[g].value;return c}function f(b){var c=[],d={label:"",value:0},e={},f=0;for(var g in b)g%30===0&&(e=a.extend(!0,{},d),e.label=b[g].label,c.push(e),f=c.length-1),c[f].value+=b[g].value;return c}var g=b;if(c=c||"daily",null===b)return null;switch(c){case"weekly":g=e(b);break;case"monthly":g=f(b);break;case"daily":g=d(b)}return g}},bars:{init:function(){h("MODE: weekday");var a=this;a.grid()},grid:function(){var a=this;a.initGridY(),a.initLegend(),a.initRects()},initGridY:function(){var a=k.width(),b=k.height(),c=0;j.config.grid.x.label!==!1&&(b-=n.labels.x.height),j.config.grid.y.label!==!1&&(c=n.labels.y.width,a-=c);var d=6,e=Math.floor(b/d);l.svg.grid.group.select("g.PAGgridY").remove(),l.svg.grid.y.group=l.svg.grid.group.append("g").classed("PAGgridY",!0);for(var f=0;d>f;f++){var g=l.svg.grid.y.group.append("line").attr("x1",c).attr("y1",b-f*e).attr("x2",k.width()).attr("y2",b-f*e).attr("stroke",j.config.grid.y.color);l.svg.grid.y.elements.push(g)}},initGraph:function(b,c,d,e){var f=this,g=a.Deferred();if(void 0!=typeof b&&l.svg.graph.elements[b])return g.resolve(b),g.promise();var i=l.data[0]?l.data[0].length:5,o=k.width(),p=k.height(),q=0,r=a.extend(!0,{},m);r.group=l.svg.graph.group.insert("g",":first-child").classed("PAGgraph",!0),r.elements.area=[],l.svg.graph.elements.push(r);var s=l.svg.graph.elements.length-1;l.svg.graph.elements[s].group.attr("data-index",s),c=c||"#"+((1<<24)*Math.random()|0).toString(16),d=d||"Graph "+s,e=e||null,j.config.graph.push({color:c,legend:d,format:e}),h("initGraph",b),j.config.grid.x.label!==!1&&(p-=n.labels.x.height),j.config.grid.y.label!==!1&&(q=n.labels.y.width,o-=q);for(var t=Math.floor(o/i),u=j.config.stacked?0:j.config.spacing/2,v=t-j.config.spacing-(l.svg.graph.elements.length-1)*u,w=0;i>w;w++){var x=w*t+q+t/2-v/2+s*u,y=p-1,z=l.svg.graph.elements[s].group.append("rect").attr("x",x).attr("y",y).attr("width",v).attr("height",1).attr("rx",j.config.rectRadius).attr("ry",j.config.rectRadius).attr("fill",j.config.graph[s].color).style("opacity",0);l.svg.graph.elements[s].elements.area.push(z)}var A=l.legend.append("p").attr("data-index",s);return A.append("span").style("background",j.config.graph[s].color),A.append("label").text(j.config.graph[s].legend),0===+s&&f.initLabelX(),setTimeout(function(){g.resolve(s)},25*i),g.promise()},initLabelX:function(){var a=5;h("initLabelX");var b=k.width(),c=k.height(),d=0;j.config.grid.x.label!==!1&&(c-=n.labels.x.height),j.config.grid.y.label!==!1&&(d=n.labels.y.width,b-=d);for(var e=Math.floor(b/a),f=0;a>f;f++){var g=f*e+d+e/2,i=l.svg.label.x.group.append("text").attr("x",g).attr("y",c+n.labels.x.marginTop).attr("text-anchor","middle").attr("fill",j.config.grid.x.label);l.svg.label.x.elements.push(i)}},animateLabelY:function(){var a=this,b=a.computedData,c=k.width(),d=k.height(),e=0;if(h("animateLabelY"),b){var f=b.length;j.config.grid.x.label&&(d-=n.labels.x.height),j.config.grid.y.label&&(e=n.labels.y.width,c-=e);var f=6,g=Math.floor(d/f);l.svg.label.y.group.classed("PAhide",!0),setTimeout(function(){for(var a=0;f>a;a++)if(l.svg.label.y.elements[a])l.svg.label.y.elements[a].text(Number(l.svg.grid.y.spacing[a]).format(j.config.grid.y.format));else{var b=l.svg.label.y.group.append("text").attr("x",50).attr("y",d-a*g).attr("text-anchor","end").attr("fill",j.config.grid.y.label).text(Number(l.svg.grid.y.spacing[a]).format(j.config.grid.y.format));l.svg.label.y.elements.push(b)}},n.animateGridTime),setTimeout(function(){l.svg.label.y.group.classed("PAhide",!1)},2*n.animateGridTime)}},animateGridX:function(){var b=this,c=a.Deferred(),d=k.width(),e=k.height(),f=0;if(j.config.grid.x.label!==!1&&(e-=n.labels.x.height),j.config.grid.y.label!==!1&&(f=n.labels.y.width,d-=f),h("animateGridX"),l.data[0]){l.svg.label.x.group.classed("PAhide",!0);var g=j.config.stacked,i=Math.floor(d/l.data[0].length),m=j.config.stacked?0:g/2,o=i-g;if(i>0){for(;g>=o;)g-=1,m=j.config.stacked?0:g/2,o=i-g-(l.svg.graph.elements.length-1)*m;0===+g&&(m=0,o=d/l.data[0].length,i=o)}else m=0,o=d/l.data[0].length,i=o;if(l.svg.graph.elements[0].elements.area.length!=l.data[0].length){for(var p=l.data[0].length;p<l.svg.graph.elements[0].elements.area.length;p++)l.svg.label.x.elements[p].transition().duration(n.graphAnimationTime).style("opacity",0).ease(n.animateEasing).each("end",function(){this.remove()}),setTimeout(function(){l.svg.label.x.elements=l.svg.label.x.elements.slice(0,l.data[0].length)},n.graphAnimationTime);for(var q in l.data)for(var p in l.data[q]){var r=p*i+f+i/2-o/2+q*m;if(l.svg.graph.elements[q].elements.area[p])l.svg.graph.elements[q].elements.area[p].transition().duration(n.graphAnimationTime).attr("width",o).attr("x",r);else{var s=l.svg.graph.elements[q].group.append("rect").attr("x",r).attr("y",e-1).attr("width",o).attr("height",1).attr("rx",j.config.rectRadius).attr("ry",j.config.rectRadius).attr("fill",j.config.graph[q].color).attr("opacity",0);s.transition().delay(n.graphAnimationTime/4).duration(n.graphAnimationTime),l.svg.graph.elements[q].elements.area.push(s)}if(0===+q){var t=p*i+f+i/2;if(l.svg.label.x.elements[p])l.svg.label.x.elements[p].transition().duration(n.graphAnimationTime/4),l.svg.label.x.elements[p].transition().delay(n.graphAnimationTime/4).duration(n.graphAnimationTime).attr("x",t).text(j.config.grid.x.format(l.data[0][p].label));else{var u=l.svg.label.x.group.append("text").attr("x",t).attr("y",e+n.labels.x.marginTop).attr("text-anchor","middle").attr("fill",j.config.grid.x.label).text(j.config.grid.x.format(l.data[0][p].label));u.transition().delay(n.graphAnimationTime/4).duration(n.graphAnimationTime),l.svg.label.x.elements.push(u)}}}}else for(var p in l.data[0]){var t=p*i+f+i/2;l.svg.label.x.elements[p].transition().delay(n.graphAnimationTime/4).duration(n.graphAnimationTime).attr("x",t).text(j.config.grid.x.format(l.data[0][p].label))}return setTimeout(function(){b.hideThickLabels(),c.resolve()},n.animateGridTime+100),c.promise()}},hideThickLabels:function(){function b(b){var c=a("<span>").hide().appendTo(document.body);c.text(b.text()).css("font-family",b.css("font-family")).css("font-weight",b.css("font-weight")).css("font-size",b.css("font-size")).css("text-transform",b.css("text-transform"));var d=c.width();return c.remove(),d}h("hideThickLabels");for(var c=k.find("g.PAGlabelX"),d=1,e=1,f=c.find("text:eq("+e+")"),g={width:b(f),x:f.position().left},i=2,j=c.find("text:eq("+i+")").position().left;g.x+g.width+10>j&&(d++,i++,c.find("text:eq("+i+")").length);)j=c.find("text:eq("+i+")").position().left;d>1?l.svg.label.x.group.classed("PAhide",!0).selectAll("text:nth-child("+d+"n+2)").classed("show",!0):l.svg.label.x.group.classed("PAhide",!1).selectAll("text").classed("show",!1)},setData:function(b,c){var d=this,m=a.Deferred(),c=c||0,o=k.width(),p=k.height(),q=0;if(j.config.grid.x.label!==!1&&(p-=n.labels.x.height),j.config.grid.y.label!==!1&&(q=n.labels.y.width,o-=q),h("setData",c),l.data.length&&0===+c&&l.data[0].length!=b.length&&(l.data=[]),l.svg.graph.elements[c].elements.area.length>b.length){for(i=b.length;i<l.svg.graph.elements[c].elements.area.length;i++)l.svg.graph.elements[c].elements.area[i].transition().duration(n.graphAnimationTime).attr("y",p).attr("height",0).style("opacity",0).ease(n.animateEasing).each("end",function(){this.remove()});setTimeout(function(){l.svg.graph.elements[c].elements.area=l.svg.graph.elements[c].elements.area.slice(0,b.length)},n.graphAnimationTime)}return b&&0!==b.length||m.reject("no"),0!=c&&l.data[0]&&l.data[0].length!=b.length?(console.log("Compare metric has a different scale"),m.reject("no")):(l.data[c]=b,d.computedData=f(l.data),l.svg.grid.y.spacing=e(g(l.data)),setTimeout(function(){m.resolve("ok")},10)),m.promise()},draw:function(){var b=this;h("draw"),b.initGridY(),promises=[],promises.push(b.animateLabelY()),promises.push(b.animateGridX()),a.when.apply(a,promises).done(function(){k.find("div.PAlegend").toggleClass("PAhide",l.data.length<2);for(var a in l.svg.graph.elements)l.data[a]?b.animateGraph(l.data[a],a):b.removeGraph(a)})},animateGraph:function(a,b){var b=b||0;h("animateGraph",b);var c=k.width(),d=k.height(),e=0;j.config.grid.x.label!==!1&&(d-=n.labels.x.height),j.config.grid.y.label!==!1&&(e=n.labels.y.width,c-=e);var f=j.config.spacing,g=Math.floor(c/a.length),i=Math.floor(d/6)/(l.svg.grid.y.spacing[1]-l.svg.grid.y.spacing[0]),m=j.config.stacked?0:f/2,o=g-f-(l.svg.graph.elements.length-1)*m;if(g>0){for(;f>=o;)f-=1,m=j.config.stacked?0:f/2,o=g-f-(l.svg.graph.elements.length-1)*m;0===+f&&(m=0,o=c/a.length,g=o)}else m=0,o=c/a.length,g=o;for(var p in l.svg.graph.elements[b].elements.area){var q=p*g+e+g/2-o/2+b*m;if("undefined"!=typeof a[p]){var r=a[p].value?parseInt(a[p].value*i-l.svg.grid.y.spacing[0]*i):1;1>r&&(r=1);var s=d-r;if(j.config.stacked&&b>0)for(var t=1*b;t>0;){t-=1;var u=l.data[t][p].value?parseInt(l.data[t][p].value*i-l.svg.grid.y.spacing[0]*i):1;s-=u}l.svg.graph.elements[b].elements.area[p].transition().duration(n.graphAnimationTime).attr("x",q).attr("y",s).attr("width",o).attr("height",r).attr("data-value",a[p].value).style("opacity",1).ease(n.animateEasing)}}},flattenGraph:function(b){var c=a.Deferred();if(h("flattenGraph",b),null==l.data[b])return c.reject(),c.promise();var d=k.height();j.config.grid.x.label!==!1&&(d-=n.labels.x.height),l.svg.graph.elements[0].group.classed("percentage",!1);for(var e in l.svg.graph.elements[b].elements.area)l.svg.graph.elements[b].elements.area[e].transition().duration(n.graphAnimationTime).attr("y",d-1).attr("height",1).ease(n.animateEasing);return setTimeout(function(){c.resolve()},n.graphAnimationTime+10),c.promise()},removeGraph:function(b){var c=this,d=a.Deferred(),b=b||l.svg.graph.elements.length-1;return a.when(c.flattenGraph(b)).done(function(){0===+b?d.reject():(delete l.data[b],l.svg.graph.elements[b].group.remove(),l.svg.graph.elements.pop(),k.find("div.PAlegend > p[data-index="+b+"]").remove(),c.computedData=f(l.data),l.svg.grid.y.spacing=e(g(l.data)),d.resolve())}),d.promise()},initLegend:function(){var b=this;k.find("div.PAlegend").on("click","p[data-index]",function(){var c=parseInt(a(this).attr("data-index"));b.moveOnFront(c)})},setLegendLabel:function(a,b){j.config.graph[b].legend=a,l.legend.select('p[data-index="'+b+'"] > label').text(a)},initRects:function(){var b=null;k.on("mouseover","g.PAGgraph > rect",function(){clearTimeout(b),l.tooltip.style("display","block");var c=a(this).parent("g").attr("data-index"),d=j.config.graph[c].format?j.config.graph[c].format:j.config.grid.y.format,e=a(this).index(),f=k.find("g.PAGlabelX > text:eq("+e+")").text();l.tooltip.select("span.time").text(f).style("background-color",j.config.graph[c].color),l.tooltip.style("color",j.config.graph[c].color).select("span.metric").text(Number(a(this).attr("data-value")).format(d)),l.tooltip.select("label").text(j.config.graph[c].legend);var g=(l.tooltip.node().getBoundingClientRect(),a(l.tooltip[0][0])),h=g.width(),i=g.height(),m=a(this).attr("x"),n=a(this).attr("y"),o=a(this).attr("width"),p=n-i-8,q=m-parseInt(h/2-o/2)-10;g.css("top",p).css("left",q).addClass("show")}).on("mouseout","g.PAGgraph > rect",function(){l.tooltip.classed("show",!1),b=setTimeout(function(){l.tooltip.style("display","none")},300)})},initCompareValues:function(){if(null!=l.data[1]){var a=k.height();j.config.grid.x.label!==!1&&(a-=n.labels.x.height);for(var b in l.data[0]){var c=l.data[0][b].value-l.data[1][b].value,d=Math.round(c/l.data[1][b].value*100);if(d=d>0?"+"+d+"%":0===+d?"":d+"%",l.svg.graph.elements[0].elements.points.elements[b])l.svg.graph.elements[0].elements.points.elements[b].text(d);else{var e=l.svg.graph.elements[0].elements.area[b],f=parseInt(e.attr("x"))+parseInt(e.attr("width")/2),g=l.svg.graph.elements[0].group.append("text").attr("x",f).attr("y",a-n.labels.x.marginTop/2).attr("text-anchor","middle").attr("fill","#fff").text(d);l.svg.graph.elements[0].elements.points.elements.push(g)}}setTimeout(function(){l.svg.graph.elements[0].group.classed("percentage",!0)},n.graphAnimationTime)}},moveOnFront:function(a){var b=k.find("g.PAGgraphs");b.find("g.PAGgraph[data-index="+a+"]").appendTo(b)}},vertical_bar:a.extend(!0,null,this.bars)};return r[j.mode].init(),k.initGraph=function(a,b,c,d){return r[j.mode].initGraph(a,b,c,d)},k.setData=function(a,b){if("function"==typeof j.preFetch)var a=j.preFetch(a);return r[j.mode].setData(a,b)},k.getData=function(a){return l.data[a]},k.getFormat=function(){return j.config.grid.y.format},k.removeGraph=function(a){return r[j.mode].removeGraph(a)},k.draw=function(){r[j.mode].draw()},k.setLegendLabel=function(a,b){r[j.mode].setLegendLabel(a,b)},j.debug&&(k.structure=l,k.MODE=r),k},a.fn.PAdonutchart=function(b){function c(a,b,c){if(a.length>b){var d=a.sort(function(a,b){return a.label===c?-1:a.label===c||"Other"!==a.label&&"Others"!==a.label?b.label===c?1:b.label===c||"Other"!==b.label&&"Others"!==b.label?a.value-b.value:1:-1}),e=d.reverse(),f=e.splice(b-1,a.length),g=0;f.map(function(a){g+=a.value}),e[e.length]={label:c,value:g},a=e}return a}function d(a){return i.entry_limit.number&&(a=c(a,i.entry_limit.number,i.entry_limit.label)),a.map(function(a){return{label:a.label,value:a.value}})}function e(a){for(var b=["#6D96A1","#596970","#A9AEC5","#553E5A","#859680","#8C4354","#87B8C4","#808F96"],c=[],d=0;d<a.length;d++)c.push(a[d].label);j.svg.color=d3.scale.ordinal().domain(c).range(b)}function f(b){var c=null,d=j.svg.element.select(".slices").selectAll("path").data(j.svg.pie(b),j.svg.key);d.enter().append("path").style("fill",function(a){return j.svg.color(a.data.label)}).attr("class","slice"),d.transition().duration(1e3).attrTween("d",function(a){var b=d3.interpolate(a.startAngle+.1,a.endAngle);return function(c){return a.endAngle=b(c),j.svg.arc(a)}}),d.on("mouseover",function(){var b=arguments[0];clearTimeout(c),j.tooltip.style("display","block"),j.tooltip.select("span").text(b.data.label),i.after?j.tooltip.select("label").text(b.data.value+" "+i.after):j.tooltip.select("label").text(b.data.value);var d=a(j.tooltip[0][0]);d.addClass("show").css("left",d3.event.layerX+10+"px").css("top",d3.event.layerY+10+"px")}),d.on("mouseout",function(){j.tooltip.classed("show",!1),c=setTimeout(function(){j.tooltip.style("display","none")},300)}),d.exit().remove()}function g(b){a(j.svg.element)[0][0];
j.legend.selectAll("p").remove();var c=j.legend.selectAll("p").data(b).enter().append("p").attr("data-index",function(a,b){return b});c.append("span").attr("opacity",0).transition().duration(500).delay(1e3).attr("opacity",1).style("background",function(a){return j.svg.color(a.label)}),c.append("label").attr("opacity",0).transition().duration(500).delay(1e3).attr("opacity",1).text(function(a){return a.label}),c.classed("small",c[0].length>3)}var h=this;h.addClass("PAgraphContainer PAdonutchart");var i=a.extend(!0,{after:null,entry_limit:{label:"Other",number:null}},b.settings),j={legend:null,tooltip:null,data:[],filters:null,svg:{radius:null,element:null,pie:null,arc:null,outer_arc:null,key:null,color:null,g:null}};return j.legend=d3.selectAll(h.get()).append("div").classed("PAlegend",!0),j.tooltip=d3.selectAll(h.get()).append("div").classed("PAtooltip",!0),j.tooltip.append("span").classed("metric",!0).text(""),j.tooltip.append("label").text(""),j.svg.element=d3.selectAll(h.get()).append("svg").classed("PAGraph",!0).attr("width","100%").attr("height",h.height()),j.svg.radius=Math.min(h.width(),h.height()-40)/2,j.svg.g=j.svg.element.append("g").attr("class","slices"),j.svg.pie=d3.layout.pie().sort(null).value(function(a){return a.value}),j.svg.arc=d3.svg.arc().outerRadius(.8*j.svg.radius).innerRadius(.4*j.svg.radius),j.svg.outer_arc=d3.svg.arc().outerRadius(.9*j.svg.radius).innerRadius(.9*j.svg.radius),j.svg.g.attr("transform","translate("+h.width()/4+","+(h.height()-50)/2+")"),j.svg.key=function(a){return a.data.label},h.animate=function(a){b.data=d(a),f(b.data),g(b.data)},h.init=function(a){b.data=d(a),e(b.data),f(b.data),g(b.data)},h.init(b.data),h},a.fn.PAbubblechart=function(a){var b={margin:{top:a.margin.top,right:a.margin.right,bottom:a.margin.bottom,left:a.margin.left}},c={legend:null,tooltip:null,data:[],filters:null,svg:{element:null,g:null,xRange:null,yRange:null,xAxis:null,yAxis:null,color:null}},d=this;d.addClass("PAbubblechartContainer");var e={init:function(e){function f(a){c.svg.circle.attr("cx",function(b){return b.x+(k.x-b.x)*(l+.02)*a.alpha}).attr("cy",function(b){return b.y+(k.y-b.y)*(l+.02)*a.alpha})}function g(){var b=10,d=5,e=c.svg.element.append("g").attr("class","legend").attr("height",100).attr("width",50).attr("transform","translate(0, 40)"),f=e.selectAll(".legend").data(a.data).enter().append("g").attr("class","legend").attr("transform",function(a,e){var f=b+d,g=f*c.svg.color.domain().length/2,h=e*f-g+10;return"translate(150,"+h+")"});f.append("text").attr("opacity",0).transition().duration(500).delay(1e3).attr("opacity",1).attr("x",-23).attr("y",9).style("text","align-right").text(function(a){return a.percentage+"%"}),f.append("circle").attr("opacity",0).transition().duration(500).delay(1e3).attr("cx",d).attr("cy",5).attr("r",5).attr("opacity",1).style("fill",function(a,b){return c.svg.color(b)}).style("stroke",function(a,b){return c.svg.color(b)}),f.append("text").attr("opacity",0).transition().duration(500).delay(1e3).attr("opacity",1).attr("x",15).attr("y",9).text(function(a){return a.device})}var h=d.width()-b.margin.left-b.margin.left,i=d.height()-b.margin.top-b.margin.bottom,j=1;d3.scale.sqrt().range([0,12]);c.svg.color=d3.scale.category20c().domain(d3.range(j));var k=(d3.scale.ordinal().domain(d3.range(j)).rangePoints([0,h],1),{x:h/3,y:i/2}),l=.1,m=d3.max(e,function(a){return a.value}),n=d3.scale.pow().exponent(.5).domain([0,m]).range([1,27]),o=[];e.forEach(function(a){var b;b={id:a.id,value:a.value,percentage:a.percentage,radius:n(a.value),charge:n(a.value),name:a.device,cx:10*Math.random(),cy:10*Math.random(),color:c.svg.color(a.id)},o.push(b)});var p=function(a){return-Math.pow(a.charge,2)/8},q=d3.layout.force().nodes(o).size([.6*h,i]).gravity(.1).charge(p).on("tick",f).start();c.svg.element=d3.selectAll(d.get()).append("svg").attr("width",h).attr("height",i),c.svg.circle=c.svg.element.selectAll("circle").data(o).enter().append("circle").attr("r",function(a){return a.radius}).attr("class",function(a){return"PAbubble-node device-"+a.id}).style("fill",function(a){return a.color}).call(q.drag),g()}};e.init(a.data)},a.fn.PAcounter=function(b){function c(b,c){b.each(function(){if(isNaN(a(this).attr("data-value")))a(this).text(a(this).attr("data-value"));else{var b=a(this).text("0"),e=setTimeout(function(){b.html(d(1*b.attr("data-value"),b.attr("data-type")))},c+10);a({c:0}).animate({c:b.attr("data-value")},{duration:c,step:function(){var a=this.c;a==b.attr("data-value")&&clearInterval(e),b.html(d(a,b.attr("data-type")))}})}})}function d(a,b){return void 0===b?Number(a).format(e.main.format):Number(a).format(e[b].format)}var e=a.extend(!0,{main:{value:0,format:{decimals:0}},secondary:{value:null,format:{decimals:0},description:null},diff:{value:null,format:{decimals:0},description:null},icon:null},b),f=this;if(f.addClass("PAcounterContainer PAinactive"),f.find(".PAicon, .PAmain, .PAcompare .PAsecondary").remove(),e.icon)var g=a("<span></span>").addClass("PAicon");var h,i,j=a("<span></span>").attr("data-value",e.main.value).attr("data-type","main").text(e.main.value).addClass("PAmain PAcount");if(e.secondary.value||e.secondary.description){h=a("<div></div>").addClass("PAcount PAcounterContainer PAcontainer"),i=a("<div></div>").addClass("PAcount PAsecondary PAcontainer");var k=a("<span></span>").attr("data-value",e.secondary.value).attr("data-type","secondary").text(e.secondary.value).addClass("PAcount PAsecondary").toggleClass("PAnegative",e.secondary.value<0).toggleClass("PAnull",0==e.secondary.value),l=a("<p></p>").text(e.secondary.description).addClass("PAdescription PAsecondary");g&&f.append(g),f.append(h),h.append(j),h.append(i),(e.secondary.value||0==e.secondary.value)&&i.append(k),e.secondary.description&&i.append(l)}else{var m=a("<div></div>").addClass("PAcount PAmainContainer PAcontainer");f.append(m);var n=null;e.diff.format.after&&!e.diff.value&&(n=a("<div></div>").html(e.diff.format.after).addClass("PAdescription description")),g&&m.append(g),m.append(j),n&&m.append(n)}if(e.icon){var o=a('<img src="'+e.icon+'" />');o.load(function(){g.append(o),c(f.find("span.PAmain"),1e3),c(f.find("span.PAsecondary"),1e3),c(f.next(),1e3),f.removeClass("PAinactive")})}else c(f.find("span.PAmain"),1e3),c(f.find("span.PAsecondary"),1e3),c(f.next(),1e3),f.removeClass("PAinactive");if(e.diff.value||0===+e.diff.value){var p;if(e.diff.description){var q=a("<div></div>").addClass("PAcompareContainer");i.append(q),p=a("<span></span>").attr("data-value",e.diff.value).attr("data-type","diff").html(e.diff.value+e.diff.format.after+" ").addClass("PAcompare PAcount").toggleClass("PAnegative",e.diff.value<0).toggleClass("PAnull",0===+e.diff.value);var r=a("<span></span>").addClass("PAcompare_description").text(e.diff.description);q.append(p),q.append(r)}else p=a("<span></span>").attr("data-value",e.diff.value).attr("data-type","diff").text(e.diff.value).addClass("PAcompare PAcount").toggleClass("PAnegative",e.diff.value<0).toggleClass("PAnull",0===+e.diff.value),f.after(p)}return f},a.fn.PAcounterSimple=function(b,c){var d="number"==typeof b?b:0;"object"==typeof b&&(c=b);var e=a.extend(!0,{number:d,format:{decimals:0},duration:1e3},c),f=this,g=Number(f.attr("data-value"))||0;f.attr("data-value",e.number).removeClass("positive negative"),f.html(Number(g).format(e.format)),e.number>0&&f.addClass("positive"),e.number<0&&f.addClass("negative");var h=setTimeout(function(){f.html(Number(e.number).format(e.format))},e.duration+10);return a({c:g}).animate({c:Number(e.number)},{duration:e.duration,step:function(){var a=this.c;a==Number(e.number)&&clearInterval(h),f.html(Number(a).format(e.format))}}),f},a.fn.PAcustom=function(e){function f(b,c,d,e,f){f||b.html(Number(0).format(d)),setTimeout(function(){b.each(function(){var b=a(this),e=0;f&&(e=parseFloat(b.text())||0);var g=setTimeout(function(){b.html(Number(1*b.attr("data-value")).format(d))},c+10);a({c:e}).animate({c:b.attr("data-value")},{duration:c,step:function(){var a=this.c;a==b.attr("data-value")&&clearInterval(g),b.html(Number(a).format(d))}})})},e||1)}var g=a.extend(!0,{mode:"horizontal_bar",data:[],main:{color:"#88b8c4",format:null},compare:{color:"#808f96",format:null}},e),h=this;h.addClass("PAcustomContainer");var i={horizontal_bar:{init:function(){var e=this;h.addClass("PACustomHBars");var f=g.main.color instanceof Array?g.main.color:[g.main.color],i=h.find("ul").length?d3.selectAll(h.get()).select("ul"):d3.selectAll(h.get()).append("ul"),j=b(g.data);Math.abs(j-c(g.data));g.data.length?h.find("ul li:gt("+(g.data.length-1)+")").remove():h.find("ul li").remove();var k=i.selectAll("li");for(var l in g.data){var m=g.data[l].value;if(m instanceof Object){var n=0;a.each(m,function(a,b){n+=b}),m=n}var o=k[0][l]?d3.select(k[0][l]):i.append("li");if(k[0][l]?(o.select("label").text(g.data[l].label),o.select("div > span").attr("data-perc",m),o.select("span.v").attr("data-value",m)):(o.append("label").text(g.data[l].label),o.append("div").append("span").attr("data-perc",m).style("background",f[0]),o.append("span").classed("v",!0).html(Number(0).format(g.main.format)).attr("data-value",m)),g.data[l].value instanceof Object){var p=o.select("span[data-perc]");p.select("span.container").remove();var q=p.append("span").classed("container",!0),r=100,s=null,t=1;a.each(g.data[l].value,function(a,b){var c=parseInt(m),e="undefined"==typeof f[t]?d():f[t];r-=c,p.attr("data-"+a,b),console.log(c),s=q.append("span").attr("data-perc",m).attr("data-key",a).style("background",e),t++}),r>0&&s.attr("data-perc",parseInt(s.attr("data-perc"))+r)}}setTimeout(function(){e.animate()},100)},animate:function(){h.find("span[data-perc]").each(function(){a(this).width(parseInt(a(this).attr("data-perc"))+"%")}),f(h.find("span[data-value]"),1e3,g.main.format,100,!0)}},gender_distribution_counters:{female_icon:'<svg viewBox="0 0 58 58"><g fill="none"><rect fill="#808F96" x="0" y="0" width="58" height="58" rx="40"></rect><circle stroke="#FFFFFF" stroke-width="2" cx="29" cy="29" r="26.88"></circle><path d="M34.52496,40.79136 C34.49584,40.46992 34.47456,39.9536 34.45776,39.41824 C39.32416,38.91984 42.73792,37.7528 42.73792,36.39312 C42.72448,36.39088 42.7256,36.33712 42.7256,36.31472 C39.08784,33.03648 45.87952,9.73936 33.23584,10.212 C32.44176,9.54 31.05184,8.94304 29.05824,8.94304 C11.93232,10.23888 19.50464,32.23904 15.60256,36.392 C15.60032,36.39312 15.59696,36.39312 15.59472,36.39312 C15.59472,36.39536 15.59584,36.3976 15.59584,36.39984 C15.59584,36.40096 15.59472,36.40208 15.59472,36.40208 C15.59472,36.40208 15.59584,36.40208 15.59696,36.4032 C15.61264,37.73488 18.91104,38.88064 23.63632,39.39136 C23.62288,39.71616 23.59488,40.11824 23.53328,40.79136 C22.09744,44.652 14.62032,44.89392 10.4752,48.7344 C12.74096,50.71232 20.63584,56.02336 29.10528,56.02336 C37.57472,56.02336 44.60832,52.00368 47.4128,48.6224 C43.25872,44.89056 35.94624,44.61392 34.52496,40.79136 L34.52496,40.79136 Z" fill="#FFFFFF"></path></g></svg>',male_icon:'<svg viewBox="0 0 58 58"><g fill="none"><rect fill="#88b8c4" x="0" y="0" width="58" height="58" rx="40"></rect><circle stroke="#FFFFFF" stroke-width="2" cx="29" cy="29" r="26.88"></circle><path d="M34.52496,40.79136 C34.36144,38.98592 34.42416,37.72592 34.42416,36.07616 C35.24176,35.6472 36.70672,32.91216 36.95424,30.6016 C37.59712,30.54896 38.61072,29.92176 38.90752,27.44544 C39.06768,26.116 38.43152,25.36784 38.044,25.13264 C39.09008,21.98656 41.26288,12.25376 34.02544,11.248 C33.28064,9.93984 31.37328,9.27792 28.89472,9.27792 C18.97824,9.46048 17.78208,16.76624 19.956,25.13264 C19.5696,25.36784 18.93344,26.116 19.09248,27.44544 C19.3904,29.92176 20.40288,30.54896 21.04576,30.6016 C21.29216,32.91104 22.81536,35.6472 23.6352,36.07616 C23.6352,37.72592 23.6968,38.98592 23.53328,40.79136 C22.12096,44.58816 14.86784,44.88496 10.68352,48.54624 C15.05824,52.9512 22.14784,56.10176 29.62944,56.10176 C37.11104,56.10176 45.90528,50.19488 47.36912,48.5832 C43.21056,44.88832 35.94064,44.6016 34.52496,40.79136 L34.52496,40.79136 Z" fill="#FFFFFF"></path></g></svg>',init:function(){var a=this;h.addClass("PACustomGenderCounter"),a.structure()},structure:function(){var a=this,b=d3.selectAll(h.get()).append("div").classed("PAdata",!0),c=b.append("p");c.html(a.male_icon).append("span").attr("data-value",0).html(Number(0).format(g.main.format));var d=b.append("p");d.html(a.female_icon).append("span").attr("data-value",0).html(Number(0).format(g.compare.format)),c.select("rect").style("fill",g.main.color),d.select("rect").style("fill",g.compare.color)},animate:function(a){h.find("div.PAdata p:eq(0) > span").attr("data-value",a[0].value),h.find("div.PAdata p:eq(1) > span").attr("data-value",a[1].value),f(h.find("span[data-value]"),1e3,g.main.format,100,!0)}},gender_distribution_v1:{female_icon:'<svg viewBox="0 0 58 58"><g fill="none"><rect fill="#808F96" x="0" y="0" width="58" height="58" rx="40"></rect><circle stroke="#FFFFFF" stroke-width="2" cx="29" cy="29" r="26.88"></circle><path d="M34.52496,40.79136 C34.49584,40.46992 34.47456,39.9536 34.45776,39.41824 C39.32416,38.91984 42.73792,37.7528 42.73792,36.39312 C42.72448,36.39088 42.7256,36.33712 42.7256,36.31472 C39.08784,33.03648 45.87952,9.73936 33.23584,10.212 C32.44176,9.54 31.05184,8.94304 29.05824,8.94304 C11.93232,10.23888 19.50464,32.23904 15.60256,36.392 C15.60032,36.39312 15.59696,36.39312 15.59472,36.39312 C15.59472,36.39536 15.59584,36.3976 15.59584,36.39984 C15.59584,36.40096 15.59472,36.40208 15.59472,36.40208 C15.59472,36.40208 15.59584,36.40208 15.59696,36.4032 C15.61264,37.73488 18.91104,38.88064 23.63632,39.39136 C23.62288,39.71616 23.59488,40.11824 23.53328,40.79136 C22.09744,44.652 14.62032,44.89392 10.4752,48.7344 C12.74096,50.71232 20.63584,56.02336 29.10528,56.02336 C37.57472,56.02336 44.60832,52.00368 47.4128,48.6224 C43.25872,44.89056 35.94624,44.61392 34.52496,40.79136 L34.52496,40.79136 Z" fill="#FFFFFF"></path></g></svg>',male_icon:'<svg viewBox="0 0 58 58"><g fill="none"><rect fill="#88b8c4" x="0" y="0" width="58" height="58" rx="40"></rect><circle stroke="#FFFFFF" stroke-width="2" cx="29" cy="29" r="26.88"></circle><path d="M34.52496,40.79136 C34.36144,38.98592 34.42416,37.72592 34.42416,36.07616 C35.24176,35.6472 36.70672,32.91216 36.95424,30.6016 C37.59712,30.54896 38.61072,29.92176 38.90752,27.44544 C39.06768,26.116 38.43152,25.36784 38.044,25.13264 C39.09008,21.98656 41.26288,12.25376 34.02544,11.248 C33.28064,9.93984 31.37328,9.27792 28.89472,9.27792 C18.97824,9.46048 17.78208,16.76624 19.956,25.13264 C19.5696,25.36784 18.93344,26.116 19.09248,27.44544 C19.3904,29.92176 20.40288,30.54896 21.04576,30.6016 C21.29216,32.91104 22.81536,35.6472 23.6352,36.07616 C23.6352,37.72592 23.6968,38.98592 23.53328,40.79136 C22.12096,44.58816 14.86784,44.88496 10.68352,48.54624 C15.05824,52.9512 22.14784,56.10176 29.62944,56.10176 C37.11104,56.10176 45.90528,50.19488 47.36912,48.5832 C43.21056,44.88832 35.94064,44.6016 34.52496,40.79136 L34.52496,40.79136 Z" fill="#FFFFFF"></path></g></svg>',donutContainer:null,donutForeground:null,init:function(){var a=this;h.hasClass("PACustomGender1")?(a.donutContainer=d3.selectAll(h.get()).select(".PAdonut"),a.donutForeground=d3.selectAll(h.get()).select(".PAdonutForeground")):a.structure(),setTimeout(function(){a.animate(g.data)},100)},structure:function(){var b=this;h.addClass("PACustomGender1"),b.donutContainer=d3.selectAll(h.get()).append("div").classed("PAdonut",!0);var c=d3.selectAll(h.get()).append("div").classed("PAdata",!0),d=c.append("p");d.html(b.male_icon).append("span").attr("data-value",0).html(Number(0).format(g.main.format)),a(d[0]).find("span[data-value]").after(a("<span>").addClass("PAlabel").text(""));var e=c.append("p");e.html(b.female_icon).append("span").attr("data-value",0).html(Number(0).format(g.compare.format)),a(e[0]).find("span[data-value]").after(a("<span>").addClass("PAlabel").text("")),d.select("rect").style("fill",g.main.color),e.select("rect").style("fill",g.compare.color);var f=10,i=a(b.donutContainer[0]).height(),j=2*Math.PI,k=d3.svg.arc().innerRadius(i/2).outerRadius(i/2).startAngle(0),l=b.donutContainer.append("svg").attr("width",i+2*f).attr("height",i+2*f).append("g").attr("width",i).attr("height",i).attr("transform","translate("+(i/2+f)+","+(i/2+f)+")");l.append("path").datum({endAngle:j}).style("stroke",g.main.color).style("stroke-width",f).attr("d",k);b.donutForeground=l.append("path").classed("PAdonutForeground",!0).datum({endAngle:0}).style("stroke",g.compare.color).style("stroke-width",f).style("opacity",0).style("stroke-linejoin","round").attr("d",k)},animate:function(b){function c(a,b){a.attrTween("d",function(a){var c=d3.interpolate(a.endAngle,b);return function(b){return a.endAngle=c(b),j(a)}})}var d=this;h.find("div.PAdata p:eq(0) > span[data-value]").attr("data-value",b[0].value||0),h.find("div.PAdata p:eq(0) > span.PAlabel").text(b[0].label),h.find("div.PAdata p:eq(1) > span[data-value]").attr("data-value",b[1].value||0),h.find("div.PAdata p:eq(1) > span.PAlabel").text(b[1].label),f(h.find("span[data-value]"),1e3,g.main.format,100,!0);var e=a(d.donutContainer[0]).height(),i=2*Math.PI,j=d3.svg.arc().innerRadius(e/2).outerRadius(e/2).startAngle(0);d.donutForeground.style("opacity",1).transition().duration(1e3).call(c,b[1].value/100*i)}},age_distribution:{male_icon:'<svg viewBox="0 0 17 15"><path d="M14.0801524,14.4567109 C15.7050178,12.9316006 16.7199993,10.764331 16.7199993,8.35999966 C16.7199993,3.74289934 12.9771,0 8.35999966,0 C3.74289934,0 0,3.74289934 0,8.35999966 C0,10.7678635 1.01796621,12.9379685 2.64701267,14.4634289 C2.65246531,14.4552179 2.65791339,14.4471119 2.66335656,14.4391127 C3.96472984,13.3004111 6.22053641,13.2081028 6.65978473,12.0272528 C6.71064139,11.4657395 6.69148306,11.0738645 6.69148306,10.5607696 C6.43650307,10.4273579 5.96276976,9.57637961 5.88613642,8.8581163 C5.6861931,8.84174464 5.37129978,8.64667798 5.27864312,7.87651301 C5.22917979,7.46304136 5.42703311,7.2303547 5.54720811,7.15720471 C4.87109313,4.55515481 5.24311312,2.28297657 8.32725632,2.22619824 C9.09811796,2.22619824 9.6913296,2.43206323 9.92297126,2.83891655 C12.1739012,3.15171987 11.4981345,6.17873641 11.1727912,7.15720471 C11.2933145,7.2303547 11.4911679,7.46304136 11.4413562,7.87651301 C11.3490479,8.64667798 11.0338062,8.84174464 10.8338629,8.8581163 C10.7568812,9.57672794 10.3012612,10.4273579 10.0469779,10.5607696 C10.0469779,11.0738645 10.0274713,11.4657395 10.0783279,12.0272528 C10.5186212,13.2122828 12.7796528,13.3014561 14.0730144,14.4506077 C14.0753917,14.4526194 14.077771,14.4546538 14.0801524,14.4567109 Z"></path></svg>',female_icon:'<svg viewBox="0 0 17 15"><path d="M14.0799816,14.4559844 C15.7049466,12.9309593 16.7199993,10.7637549 16.7199993,8.35948679 C16.7199993,3.74266972 12.9771,0 8.35999966,0 C3.74289934,0 0,3.74266972 0,8.35948679 C0,10.7645778 1.0157477,12.9324428 2.64168654,14.4575501 C3.93892102,13.3005812 6.21815684,13.2138769 6.65978473,12.026515 C6.67894306,11.8171795 6.68765139,11.6921355 6.69183139,11.5911251 C5.22221312,11.4322948 4.19637149,11.0759717 4.19323649,10.6583457 C5.40682978,9.36680495 3.05174821,2.52491332 8.37811299,2.1219164 C8.9981463,2.1219164 9.43042795,2.30756667 9.67739627,2.51655384 C13.6097311,2.36956619 11.4974379,9.61480306 12.6326561,10.658694 C12.6326561,11.0815447 11.5709362,11.4444857 10.0574279,11.5994845 C10.0626529,11.7659777 10.0692713,11.9265495 10.0783279,12.026515 C10.5196091,13.2132765 12.7868802,13.3010401 14.0799816,14.4559844 Z"></path></svg>',init:function(){var b=this;h.addClass("PACustomAgeDist");var c=d3.selectAll(h.get()).append("ul"),d=d3.selectAll(h.get()).append("div").classed("PAdetail hide",!0),e=d.append("p").classed("PAmale",!0).html(b.male_icon).style("color",g.main.color),i=e.append("label"),j=d.append("p").classed("PAfemale",!0).html(b.female_icon).style("color",g.compare.color),k=j.append("label"),l=0,m=100;for(var n in g.data){var o=g.data[n].value.m+g.data[n].value.f;l=o>l?o:l,m=m>o?o:m}var p=Math.abs(l-m)/50;for(var n in g.data){var q=c.append("li").attr("data-male",g.data[n].value.m).attr("data-female",g.data[n].value.f),r=g.data[n].value.m+g.data[n].value.f;if(r>0){q.append("label").text(g.data[n].label);var s=q.append("div").append("span").attr("data-perc",r/p).style("background",g.main.color),t=g.data[n].value.f/r;s.append("span").classed("PAhide",!0).attr("data-perc",100*t).style("background",g.compare.color),q.append("span").html(Number(r).format(g.main.format)).attr("data-value",r)}}h.on("click","li",function(){var b=a(this).find("span > span");h.find("li span > span").not(b).addClass("PAhide"),b.toggleClass("PAhide"),h.find("div.PAdetail").toggleClass("hide",0===h.find("li span > span:not(.PAhide)").length);var c=1*a(this).attr("data-male"),d=1*a(this).attr("data-female"),e=c/(c+d)*100;i.attr("data-value",e),k.attr("data-value",100-e),f(h.find("div.PAdetail label[data-value]"),1e3,g.main.format,null,!0)})},animate:function(b){var c=0,d=100;for(var e in b){var i=b[e].value.m+b[e].value.f;c=i>c?i:c,d=d>i?i:d}var j=Math.abs(c-d)/50;d3.selectAll(h.get()).selectAll("li:nth-child(n+"+parseInt(b.length+1)+")").transition().duration(300).style("opacity","0").delay(300).remove();var k=d3.selectAll(h.get()).selectAll("ul li");for(var e in b){var l=d3.select(k[0][e]),m=b[e].value.m+b[e].value.f;if(!l[0][0]){var l=d3.selectAll(h.get()).select("ul").append("li");if(m>0){l.append("label");var n=l.append("div").append("span").style("background",g.main.color),o=b[e].value.f/(b[e].value.m+b[e].value.f);n.append("span").classed("PAhide",!0).style("background",g.compare.color),l.append("span").html(Number(m).format(g.main.format))}}l.attr("data-male",b[e].value.m).attr("data-female",b[e].value.f),l.select("label").text(b[e].label);var o=b[e].value.f/m*100;l.select("div > span").attr("data-perc",m/j).select("span").classed("PAhide",!0).attr("data-perc",o),l.select("span[data-value]").attr("data-value",m),h.find("div.PAdetail").addClass("hide")}h.find("span[data-perc]").each(function(){a(this).width(parseInt(a(this).attr("data-perc"))+"%")}),f(h.find("span[data-value]"),1e3,g.main.format,null,!0)}},age_and_gender_distribution:{male_icon:'<svg viewBox="0 0 17 15"><path d="M14.0801524,14.4567109 C15.7050178,12.9316006 16.7199993,10.764331 16.7199993,8.35999966 C16.7199993,3.74289934 12.9771,0 8.35999966,0 C3.74289934,0 0,3.74289934 0,8.35999966 C0,10.7678635 1.01796621,12.9379685 2.64701267,14.4634289 C2.65246531,14.4552179 2.65791339,14.4471119 2.66335656,14.4391127 C3.96472984,13.3004111 6.22053641,13.2081028 6.65978473,12.0272528 C6.71064139,11.4657395 6.69148306,11.0738645 6.69148306,10.5607696 C6.43650307,10.4273579 5.96276976,9.57637961 5.88613642,8.8581163 C5.6861931,8.84174464 5.37129978,8.64667798 5.27864312,7.87651301 C5.22917979,7.46304136 5.42703311,7.2303547 5.54720811,7.15720471 C4.87109313,4.55515481 5.24311312,2.28297657 8.32725632,2.22619824 C9.09811796,2.22619824 9.6913296,2.43206323 9.92297126,2.83891655 C12.1739012,3.15171987 11.4981345,6.17873641 11.1727912,7.15720471 C11.2933145,7.2303547 11.4911679,7.46304136 11.4413562,7.87651301 C11.3490479,8.64667798 11.0338062,8.84174464 10.8338629,8.8581163 C10.7568812,9.57672794 10.3012612,10.4273579 10.0469779,10.5607696 C10.0469779,11.0738645 10.0274713,11.4657395 10.0783279,12.0272528 C10.5186212,13.2122828 12.7796528,13.3014561 14.0730144,14.4506077 C14.0753917,14.4526194 14.077771,14.4546538 14.0801524,14.4567109 Z"></path></svg>',female_icon:'<svg viewBox="0 0 17 15"><path d="M14.0799816,14.4559844 C15.7049466,12.9309593 16.7199993,10.7637549 16.7199993,8.35948679 C16.7199993,3.74266972 12.9771,0 8.35999966,0 C3.74289934,0 0,3.74266972 0,8.35948679 C0,10.7645778 1.0157477,12.9324428 2.64168654,14.4575501 C3.93892102,13.3005812 6.21815684,13.2138769 6.65978473,12.026515 C6.67894306,11.8171795 6.68765139,11.6921355 6.69183139,11.5911251 C5.22221312,11.4322948 4.19637149,11.0759717 4.19323649,10.6583457 C5.40682978,9.36680495 3.05174821,2.52491332 8.37811299,2.1219164 C8.9981463,2.1219164 9.43042795,2.30756667 9.67739627,2.51655384 C13.6097311,2.36956619 11.4974379,9.61480306 12.6326561,10.658694 C12.6326561,11.0815447 11.5709362,11.4444857 10.0574279,11.5994845 C10.0626529,11.7659777 10.0692713,11.9265495 10.0783279,12.026515 C10.5196091,13.2132765 12.7868802,13.3010401 14.0799816,14.4559844 Z"></path></svg>',init:function(){var b=this;h.addClass("PACustomAgeDist PACustomGenderDist");var c=d3.selectAll(h.get()).append("ul"),d=d3.selectAll(h.get()).append("div").classed("PAdata",!0),e=d.append("p");e.html(b.male_icon).append("span").attr("data-value",0).html(Number(0).format(g.main.format));var i=d.append("p");i.html(b.female_icon).append("span").attr("data-value",0).html(Number(0).format(g.compare.format)),e.select("path").style("fill",g.main.color),i.select("path").style("fill",g.compare.color);var j=0,k=100;for(var l in g.data){var m=g.data[l].value.m+g.data[l].value.f;k=m>k?m:k,j=j>m?m:j}var n=Math.abs(k-j)/50;for(var l in g.data){var o=c.append("li").attr("data-male",g.data[l].value.m).attr("data-female",g.data[l].value.f),p=g.data[l].value.m+g.data[l].value.f;if(p>0){o.append("label").text(g.data[l].label);var q=o.append("div").append("span").attr("data-perc",p/n).style("background",g.main.color),r=g.data[l].value.f/p;q.append("span").classed("PAhide",!0).attr("data-perc",100*r).style("background",g.compare.color),o.append("span").html(Number(p).format(g.main.format)).attr("data-value",p)}}h.find("li").hover(function(){var c=a(this).find("span > span");c.removeClass("PAhide"),h.find("div.PAdetail").toggleClass("hide",0===h.find("li span > span:not(.PAhide)").length);var d=1*a(this).attr("data-male"),e=1*a(this).attr("data-female"),i=d/(d+e)*100,j={m:i,f:100-i};b.animate_gender_dist(j),f(h.find("div.PAdetail label[data-value]"),400,g.main.format,null,!0)},function(){var c=a(this).find("span > span");c.addClass("PAhide"),h.find("div.PAdetail").toggleClass("hide",0===h.find("li span > span:not(.PAhide)").length);for(var d=a(this).closest("ul"),e=d.find("li").toArray(),i=0,j=0,k=0;k<e.length;k++)j+=parseFloat(e[k].dataset.female),i+=parseFloat(e[k].dataset.male);var l=i/(i+j)*100,m={m:l,f:100-l};b.animate_gender_dist(m),f(h.find("div.PAdetail label[data-value]"),400,g.main.format,null,!0)})},animate_gender_dist:function(a){h.find("div.PAdata p:eq(0) > span").attr("data-value",a.m),h.find("div.PAdata p:eq(1) > span").attr("data-value",a.f),f(h.find("span[data-value]"),300,g.main.format,100,!0)},animate:function(b){for(var c=0,d=0,e=0,i=0;i<b.length;i++)c+=b[i].value.f,d+=b[i].value.m,e+=b[i].value.m,e+=b[i].value.f;var j=c/e*100;h.find("div.PAdata p:eq(0) > span").attr("data-value",100-j),h.find("div.PAdata p:eq(1) > span").attr("data-value",j),f(h.find("span[data-value]"),1e3,g.main.format,100,!0);var k=0,l=100;for(var m in b){var n=b[m].value.m+b[m].value.f;k=n>k?n:k,l=l>n?n:l}Math.abs(k-l)/50;d3.selectAll(h.get()).selectAll("li:nth-child(n+"+parseInt(b.length+1)+")").transition().duration(300).style("opacity","0").delay(300).remove();var o=d3.selectAll(h.get()).selectAll("ul li");for(var m in b){var p=d3.select(o[0][m]),q=b[m].value.m+b[m].value.f;if(!p[0][0]){var p=d3.selectAll(h.get()).select("ul").append("li");if(q>0){p.append("label");var r=p.append("div").append("span").style("background",g.main.color),s=b[m].value.f/(b[m].value.m+b[m].value.f);r.append("span").classed("PAhide",!0).style("background",g.compare.color),p.append("span").html(Number(q).format(g.main.format))}}p.attr("data-male",b[m].value.m).attr("data-female",b[m].value.f),p.select("label").text(b[m].label);var s=b[m].value.f/q*100;p.select("div > span").attr("data-perc",q).select("span").classed("PAhide",!0).attr("data-perc",s),p.select("span[data-value]").attr("data-value",q),h.find("div.PAdetail").addClass("hide")}h.find("span[data-perc]").each(function(){a(this).width(parseInt(a(this).attr("data-perc"))+"%")}),f(h.find("span[data-value]"),1e3,g.main.format,null,!0)}}};return i[g.mode].init(),h.animate=function(a){i[g.mode].animate(a)},h}}(jQuery),String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},Number.prototype.format=function(a){function b(a){var b,c=[{value:1e18,symbol:"E"},{value:1e15,symbol:"P"},{value:1e12,symbol:"T"},{value:1e9,symbol:"G"},{value:1e6,symbol:"M"},{value:1e3,symbol:"k"}];for(b=0;b<c.length;b++)if(a>=c[b].value)return{number:parseFloat((a/c[b].value).toFixed(10).replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1")),symbol:c[b].symbol};return{number:parseFloat(a),symbol:""}}if(!a)return this.valueOf();var c=parseFloat(this.valueOf()),d=a.after||"";if(a.trimK){var e=b(this);c=e.number,d=e.symbol+d}var f="\\d(?=(\\d{3})+"+(a.decimals>0?"\\D":"$")+")",c=c.toFixed(Math.max(0,~~a.decimals)),g=(a.decimal?c.replace(".",a.decimal):c).replace(new RegExp(f,"g"),"$&"+(a.thousand||""));return(a.before||"")+g+d};